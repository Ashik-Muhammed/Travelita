import{c as e,d as s,g as t,j as a,k as l,f as r}from"./index-Byul4zVF.js";import{r as i,u as n,L as d}from"./router-CE_eIJm-.js";import"./react-CMmhtoO5.js";function c(){const[c,o]=i.useState([]),[x,m]=i.useState(!0),[u,g]=i.useState(null),[h,p]=i.useState(!1),[b,v]=i.useState(""),[f,j]=i.useState("all"),[y,N]=i.useState(""),[w,k]=i.useState(null),[C,S]=i.useState(null),A=n();i.useEffect((()=>{const e=localStorage.getItem("user");if(e){try{const s=JSON.parse(e);S(s.role),"admin"!==s.role&&"vendor"!==s.role&&A("/")}catch(s){A("/login")}P()}else A("/login")}),[A]),i.useEffect((()=>{if(y){const e=setTimeout((()=>{N("")}),3e3);return()=>clearTimeout(e)}}),[y]);const P=async()=>{try{m(!0);const a=JSON.parse(localStorage.getItem("user"));if(!a)return g("Authentication required"),void m(!1);const l=e(s,"packages"),r=await t(l);if(r.exists()){let e=Object.entries(r.val()).map((([e,s])=>({id:e,...s,_id:e})));"admin"!==C&&(e=e.filter((e=>e.vendorId===a.id))),o(e)}else o([]);m(!1)}catch(a){g("Failed to fetch packages. Please try again."),m(!1)}},L=c.filter((e=>{const s=(null==e?void 0:e.title)||"",t=(null==e?void 0:e.destination)||"",a=s.toLowerCase().includes(b.toLowerCase())||t.toLowerCase().includes(b.toLowerCase());return"all"===f?a:"active"===f?a&&e.available:"inactive"===f?a&&!e.available:"pending"===f?a&&"pending"===e.status:"rejected"===f?a&&"rejected"===e.status:a}));return x?a.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):u?a.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:a.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md text-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),a.jsx("p",{className:"text-gray-700",children:u}),a.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Try Again"})]})}):a.jsx("div",{className:"min-h-screen bg-gray-100 py-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Manage Tour Packages"}),a.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"admin"===C?"View and manage all tour packages":"View, edit, or remove your tour packages"})]}),!1]}),y&&a.jsx("div",{className:"mb-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",role:"alert",children:a.jsx("span",{className:"block sm:inline",children:y})}),a.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:a.jsx("div",{className:"px-4 py-5 sm:p-6",children:a.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[a.jsxs("div",{className:"col-span-1 md:col-span-2",children:[a.jsx("label",{htmlFor:"search",className:"sr-only",children:"Search"}),a.jsxs("div",{className:"relative rounded-md shadow-sm",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),a.jsx("input",{type:"text",id:"search",className:"focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 pr-12 sm:text-sm border-gray-300 rounded-md",placeholder:"Search packages by title or destination",value:b,onChange:e=>v(e.target.value)})]})]}),a.jsxs("div",{className:"col-span-1",children:[a.jsx("label",{htmlFor:"filter",className:"sr-only",children:"Filter"}),a.jsxs("select",{id:"filter",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",value:f,onChange:e=>j(e.target.value),children:[a.jsx("option",{value:"all",children:"All Packages"}),a.jsx("option",{value:"active",children:"Active"}),a.jsx("option",{value:"inactive",children:"Inactive"}),a.jsx("option",{value:"pending",children:"Pending Approval"}),a.jsx("option",{value:"rejected",children:"Rejected"})]})]})]})})}),0===L.length?a.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg p-6 text-center",children:[a.jsx("p",{className:"text-gray-500",children:"No packages found matching your criteria."}),"admin"!==C&&a.jsx(d,{to:"/vendor/packages/add",className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Add Your First Package"})]}):a.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:L.map((t=>a.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[a.jsxs("div",{className:"relative h-48 w-full overflow-hidden",children:[a.jsx("img",{className:"h-full w-full object-cover",src:t.images&&t.images.length>0?t.images[0]:"https://via.placeholder.com/300x200?text=No+Image",alt:t.title||"Tour Package"}),a.jsx("div",{className:"absolute top-0 right-0 mt-2 mr-2",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("approved"===t.status?t.available?"bg-green-100 text-green-800":"bg-red-100 text-red-800":"pending"===t.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:"approved"===t.status?t.available?"Active":"Inactive":t.status.charAt(0).toUpperCase()+t.status.slice(1)})})]}),a.jsxs("div",{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t.title}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"text-gray-500",children:[a.jsxs("span",{className:"inline-block mr-3",children:[a.jsx("svg",{className:"h-4 w-4 text-gray-400 inline mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),t.destination]}),a.jsxs("span",{className:"inline-block",children:[a.jsx("svg",{className:"h-4 w-4 text-gray-400 inline mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),t.duration]})]}),a.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["â‚¹",t.price]})]}),a.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:t.description})]}),w===t.id?a.jsxs("div",{className:"flex flex-col space-y-2",children:[a.jsx("p",{className:"text-sm text-red-600 font-semibold",children:"Are you sure you want to delete this package?"}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{onClick:()=>(async t=>{try{p(!0);const a=e(s,`packages/${t}`);await l(a),o(c.filter((e=>e.id!==t))),N("Package deleted successfully"),p(!1),k(null)}catch(a){g("Failed to delete package. Please try again."),p(!1),k(null)}})(t.id),disabled:h,className:"w-1/2 inline-flex justify-center items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-red-600 hover:bg-red-700",children:"Yes, Delete"}),a.jsx("button",{onClick:()=>k(null),className:"w-1/2 inline-flex justify-center items-center px-2.5 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"})]})]}):a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(d,{to:`/packages/${t.id}`,className:"w-1/3 inline-flex justify-center items-center px-2.5 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"View"}),"admin"!==C&&a.jsx(d,{to:`/vendor/packages/edit/${t.id}`,className:"w-1/3 inline-flex justify-center items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-blue-600 hover:bg-blue-700",children:"Edit"}),"approved"===t.status&&a.jsx("button",{onClick:()=>(async(t,a)=>{try{p(!0);const l=e(s,`packages/${t}`);await r(l,{available:!a}),o(c.map((e=>e.id===t?{...e,available:!a}:e))),N(`Package ${a?"deactivated":"activated"} successfully`),p(!1)}catch(l){p(!1)}})(t.id,t.available),disabled:h,className:"w-1/3 inline-flex justify-center items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-white "+(t.available?"bg-orange-500 hover:bg-orange-600":"bg-green-600 hover:bg-green-700"),children:t.available?"Deactivate":"Activate"}),a.jsx("button",{onClick:()=>k(t.id),disabled:h,className:"w-1/3 inline-flex justify-center items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]},t.id)))})]})})}export{c as default};
