import{j as e}from"./index-DbrkFvWc.js";import{r as a,L as s,d as t,u as n}from"./router-DJX9oSP-.js";import{a as i}from"./axios-rSMZb3Ae.js";import"./react-CMmhtoO5.js";const l=()=>{const[t,n]=a.useState([]),[l,o]=a.useState(!0),[r,c]=a.useState(null),[d,u]=a.useState({show:!1,packageId:null});a.useEffect((()=>{m()}),[]);const m=async()=>{try{o(!0),c(null);const e=localStorage.getItem("vendorToken");if(!e)return c("Authentication required"),void o(!1);const a=await i.get("http://localhost:5000/api/vendors/packages",{headers:{Authorization:`Bearer ${e}`}});n(a.data.packages||[])}catch(e){c("Failed to fetch packages. Please try again.")}finally{o(!1)}};return l?e.jsx("div",{className:"packages-loading",children:"Loading packages..."}):r?e.jsx("div",{className:"packages-error",children:r}):0===t.length?e.jsx("div",{className:"no-packages",children:e.jsx("p",{children:"You haven't added any tour packages yet."})}):e.jsxs("div",{className:"vendor-packages",children:[e.jsx("div",{className:"packages-grid",children:t.map((a=>e.jsxs("div",{className:"package-card",children:[e.jsxs("div",{className:"package-image",children:[e.jsx("img",{src:a.images&&a.images.length>0?`http://localhost:5000/uploads/${a.images[0]}`:"https://via.placeholder.com/300x200?text=No+Image",alt:a.title}),e.jsx("span",{className:"package-status "+(a.available?"active":"inactive"),children:a.available?"Active":"Inactive"})]}),e.jsxs("div",{className:"package-content",children:[e.jsx("h3",{children:a.title}),e.jsxs("p",{className:"package-destination",children:[a.destination," • ",a.duration]}),e.jsxs("p",{className:"package-price",children:["₹",a.price.toLocaleString()]}),e.jsxs("div",{className:"package-actions",children:[e.jsx("button",{className:"status-toggle "+(a.available?"deactivate":"activate"),onClick:()=>(async(e,a)=>{try{const s=localStorage.getItem("vendorToken");if(!s)return;await i.patch(`http://localhost:5000/api/packages/${e}`,{available:!a},{headers:{Authorization:`Bearer ${s}`}}),n(t.map((s=>s._id===e?{...s,available:!a}:s)))}catch(s){alert("Failed to update package status")}})(a._id,a.available),children:a.available?"Deactivate":"Activate"}),e.jsx(s,{to:`/packages/${a._id}`,className:"view-button",children:"View"}),e.jsx(s,{to:`/vendor/edit-package/${a._id}`,className:"edit-button",children:"Edit"}),e.jsx("button",{className:"delete-button",onClick:()=>u({show:!0,packageId:a._id}),children:"Delete"})]})]})]},a._id)))}),d.show&&e.jsx("div",{className:"delete-modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h3",{children:"Confirm Deletion"}),e.jsx("p",{children:"Are you sure you want to delete this package? This action cannot be undone."}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-button",onClick:()=>u({show:!1,packageId:null}),children:"Cancel"}),e.jsx("button",{className:"confirm-button",onClick:async()=>{if(d.packageId)try{const e=localStorage.getItem("vendorToken");if(!e)return;await i.delete(`http://localhost:5000/api/packages/${d.packageId}`,{headers:{Authorization:`Bearer ${e}`}}),n(t.filter((e=>e._id!==d.packageId))),u({show:!1,packageId:null})}catch(e){alert("Failed to delete package")}},children:"Delete"})]})]})})]})},o=()=>{const[s,t]=a.useState([]),[n,l]=a.useState(!0),[o,r]=a.useState(null),[c,d]=a.useState("all"),[u,m]=a.useState({});a.useEffect((()=>{h()}),[]);const h=async()=>{try{l(!0),r(null);const e=localStorage.getItem("vendorToken");if(!e)return r("Authentication required"),void l(!1);const a=(await i.get("http://localhost:5000/api/vendors/bookings",{headers:{Authorization:`Bearer ${e}`}})).data.bookings||[];t(a);const s=[...new Set(a.map((e=>e.packageId)))];await p(s)}catch(e){r("Failed to fetch bookings. Please try again.")}finally{l(!1)}},p=async e=>{try{const a={};for(const s of e){const e=await i.get(`http://localhost:5000/api/packages/${s}`);a[s]=e.data.title}m(a)}catch(a){}},g=async(e,a)=>{try{const n=localStorage.getItem("vendorToken");if(!n)return;await i.patch(`http://localhost:5000/api/bookings/${e}/status`,{status:a},{headers:{Authorization:`Bearer ${n}`}}),t(s.map((s=>s._id===e?{...s,status:a}:s)))}catch(n){alert("Failed to update booking status")}},v="all"===c?s:s.filter((e=>e.status===c));return n?e.jsx("div",{className:"bookings-loading",children:"Loading bookings..."}):o?e.jsx("div",{className:"bookings-error",children:o}):e.jsxs("div",{className:"vendor-bookings",children:[e.jsxs("div",{className:"booking-filters",children:[e.jsx("button",{className:"filter-button "+("all"===c?"active":""),onClick:()=>d("all"),children:"All"}),e.jsx("button",{className:"filter-button "+("pending"===c?"active":""),onClick:()=>d("pending"),children:"Pending"}),e.jsx("button",{className:"filter-button "+("confirmed"===c?"active":""),onClick:()=>d("confirmed"),children:"Confirmed"}),e.jsx("button",{className:"filter-button "+("completed"===c?"active":""),onClick:()=>d("completed"),children:"Completed"}),e.jsx("button",{className:"filter-button "+("cancelled"===c?"active":""),onClick:()=>d("cancelled"),children:"Cancelled"})]}),0===v.length?e.jsx("div",{className:"no-bookings",children:e.jsxs("p",{children:["No ","all"!==c?c:""," bookings found."]})}):e.jsx("div",{className:"bookings-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Booking ID"}),e.jsx("th",{children:"Package"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Booking Date"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:v.map((a=>{var s,t;return e.jsxs("tr",{children:[e.jsx("td",{children:a._id.substring(a._id.length-8)}),e.jsx("td",{children:u[a.packageId]||"Unknown Package"}),e.jsx("td",{children:a.customerName||"Unknown"}),e.jsx("td",{children:(t=a.bookingDate,new Date(t).toLocaleDateString())}),e.jsxs("td",{children:["₹",(null==(s=a.price)?void 0:s.toLocaleString())||"N/A"]}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${a.status}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})}),e.jsx("td",{children:e.jsxs("div",{className:"booking-actions",children:["pending"===a.status&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"confirm-button",onClick:()=>g(a._id,"confirmed"),children:"Confirm"}),e.jsx("button",{className:"cancel-button",onClick:()=>g(a._id,"cancelled"),children:"Cancel"})]}),"confirmed"===a.status&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"complete-button",onClick:()=>g(a._id,"completed"),children:"Mark Complete"}),e.jsx("button",{className:"cancel-button",onClick:()=>g(a._id,"cancelled"),children:"Cancel"})]}),("completed"===a.status||"cancelled"===a.status)&&e.jsx("span",{children:"No actions available"})]})})]},a._id)}))})]})})]})},r=({vendorInfo:s})=>{const[t,n]=a.useState({name:(null==s?void 0:s.name)||"",email:(null==s?void 0:s.email)||"",companyName:(null==s?void 0:s.companyName)||"",phone:(null==s?void 0:s.phone)||"",address:(null==s?void 0:s.address)||"",currentPassword:"",newPassword:"",confirmPassword:""}),[l,o]=a.useState(!1),[r,c]=a.useState(!1),[d,u]=a.useState(null),[m,h]=a.useState(null),[p,g]=a.useState(!1),v=e=>{n({...t,[e.target.name]:e.target.value})};return e.jsxs("div",{className:"vendor-profile",children:[e.jsx("h2",{children:"Profile Information"}),d&&e.jsx("div",{className:"profile-error",children:d}),m&&e.jsx("div",{className:"profile-success",children:m}),e.jsxs("form",{onSubmit:async e=>{var a,s;e.preventDefault(),c(!0),u(null),h(null);try{const e=localStorage.getItem("vendorToken");if(!e)return u("Authentication required"),void c(!1);const a=p?t:{name:t.name,companyName:t.companyName,phone:t.phone,address:t.address};if(p){if(!t.currentPassword)return u("Current password is required"),void c(!1);if(t.newPassword!==t.confirmPassword)return u("New passwords do not match"),void c(!1);if(t.newPassword.length<6)return u("New password must be at least 6 characters"),void c(!1)}const s=await i.patch("http://localhost:5000/api/vendors/profile",a,{headers:{Authorization:`Bearer ${e}`}});h("Profile updated successfully"),s.data.vendor&&localStorage.setItem("vendorInfo",JSON.stringify(s.data.vendor)),p&&(n({...t,currentPassword:"",newPassword:"",confirmPassword:""}),g(!1)),o(!1)}catch(l){u((null==(s=null==(a=l.response)?void 0:a.data)?void 0:s.message)||"Failed to update profile. Please try again.")}finally{c(!1)}},className:"profile-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Full Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:t.name,onChange:v,disabled:!l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:t.email,disabled:!0,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"companyName",children:"Company Name"}),e.jsx("input",{type:"text",id:"companyName",name:"companyName",value:t.companyName,onChange:v,disabled:!l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:t.phone,onChange:v,disabled:!l})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"address",children:"Business Address"}),e.jsx("textarea",{id:"address",name:"address",value:t.address,onChange:v,rows:"3",disabled:!l})]}),l&&p&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Change Password"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentPassword",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPassword",name:"currentPassword",value:t.currentPassword,onChange:v})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"newPassword",children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",name:"newPassword",value:t.newPassword,onChange:v,minLength:"6"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:t.confirmPassword,onChange:v,minLength:"6"})]})]}),e.jsx("div",{className:"profile-actions",children:l?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"submit",className:"save-button",disabled:r,children:r?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",className:"cancel-button",onClick:()=>{o(!1),g(!1),n({name:(null==s?void 0:s.name)||"",email:(null==s?void 0:s.email)||"",companyName:(null==s?void 0:s.companyName)||"",phone:(null==s?void 0:s.phone)||"",address:(null==s?void 0:s.address)||"",currentPassword:"",newPassword:"",confirmPassword:""})},children:"Cancel"}),!p&&e.jsx("button",{type:"button",className:"password-button",onClick:()=>g(!0),children:"Change Password"})]}):e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",className:"edit-button",onClick:()=>o(!0),children:"Edit Profile"})})})]})]})},c=({onSuccess:s,isEditing:l=!1,packageData:o=null})=>{const{packageId:r}=t(),c=n(),[d,u]=a.useState({title:"",description:"",destination:"",duration:"",price:"",included:["","",""],available:!0,featured:!1}),[m,h]=a.useState([{title:"Day 1",description:""}]),[p,g]=a.useState([]),[v,x]=a.useState(!!l),[j,b]=a.useState(!1),[f,k]=a.useState(null),[N,y]=a.useState(null),[w,C]=a.useState([]);a.useEffect((()=>{l&&r?S():o&&P(o)}),[l,r,o]);const S=async()=>{try{x(!0),k(null);const e=await i.get(`http://localhost:5000/api/packages/${r}`);P(e.data)}catch(e){k("Failed to fetch package details for editing")}finally{x(!1)}},P=e=>{var a,s;u({title:e.title||"",description:e.description||"",destination:e.destination||"",duration:e.duration||"",price:e.price||"",included:(null==(a=e.included)?void 0:a.length)>0?e.included:["","",""],available:void 0===e.available||e.available,featured:e.featured||!1}),h((null==(s=e.itinerary)?void 0:s.length)>0?e.itinerary:[{title:"Day 1",description:""}]),e.images&&e.images.length>0&&C(e.images.map((e=>({url:`http://localhost:5000/uploads/${e}`,name:e,isExisting:!0}))))},I=e=>{const{name:a,value:s,type:t,checked:n}=e.target;u({...d,[a]:"checkbox"===t?n:s})},F=(e,a,s)=>{const t=[...m];t[e]={...t[e],[a]:s},h(t)};return v?e.jsx("div",{className:"package-form-loading",children:"Loading package data..."}):e.jsxs("div",{className:"package-form-container",children:[f&&e.jsx("div",{className:"form-error",children:f}),N&&e.jsx("div",{className:"form-success",children:N}),e.jsxs("form",{onSubmit:async e=>{var a,t;e.preventDefault(),b(!0),k(null),y(null);try{const e=localStorage.getItem("vendorToken");if(!e)return k("Authentication required"),void b(!1);const a=new FormData;a.append("title",d.title),a.append("description",d.description),a.append("destination",d.destination),a.append("duration",d.duration),a.append("price",d.price),a.append("available",d.available),a.append("featured",d.featured);const t=d.included.filter((e=>""!==e.trim()));a.append("included",JSON.stringify(t));const n=m.filter((e=>""!==e.description.trim()));a.append("itinerary",JSON.stringify(n));const o=w.filter((e=>e.isExisting)).map((e=>e.name));let c;a.append("existingImages",JSON.stringify(o)),p.forEach((e=>{a.append("images",e)})),l?(c=await i.put(`http://localhost:5000/api/packages/${r}`,a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e}`}}),y("Package updated successfully")):(c=await i.post("http://localhost:5000/api/packages",a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e}`}}),y("New package created successfully")),s&&setTimeout((()=>{s(c.data)}),1500)}catch(n){k((null==(t=null==(a=n.response)?void 0:a.data)?void 0:t.message)||"Failed to save package. Please try again.")}finally{b(!1)}},className:"package-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Package Title*"}),e.jsx("input",{type:"text",id:"title",name:"title",value:d.title,onChange:I,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description*"}),e.jsx("textarea",{id:"description",name:"description",value:d.description,onChange:I,rows:"4",required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"destination",children:"Destination*"}),e.jsx("input",{type:"text",id:"destination",name:"destination",value:d.destination,onChange:I,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"duration",children:"Duration*"}),e.jsx("input",{type:"text",id:"duration",name:"duration",value:d.duration,onChange:I,placeholder:"e.g. 3 Days / 2 Nights",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"price",children:"Price (₹)*"}),e.jsx("input",{type:"number",id:"price",name:"price",value:d.price,onChange:I,min:"0",required:!0})]})]}),e.jsxs("div",{className:"form-row checkbox-row",children:[e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsx("input",{type:"checkbox",id:"available",name:"available",checked:d.available,onChange:I}),e.jsx("label",{htmlFor:"available",children:"Available for Booking"})]}),e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsx("input",{type:"checkbox",id:"featured",name:"featured",checked:d.featured,onChange:I}),e.jsx("label",{htmlFor:"featured",children:"Featured Package"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"What's Included"}),d.included.map(((a,s)=>e.jsxs("div",{className:"form-row included-item",children:[e.jsx("input",{type:"text",value:a,onChange:e=>((e,a)=>{const s=[...d.included];s[e]=a,u({...d,included:s})})(s,e.target.value),placeholder:`Item ${s+1}`}),e.jsx("button",{type:"button",className:"remove-button",onClick:()=>(e=>{const a=[...d.included];a.splice(e,1),u({...d,included:a})})(s),children:"Remove"})]},`included-${s}`))),e.jsx("button",{type:"button",className:"add-button",onClick:()=>{u({...d,included:[...d.included,""]})},children:"Add Item"})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Itinerary"}),m.map(((a,s)=>e.jsxs("div",{className:"itinerary-day",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",value:a.title,onChange:e=>F(s,"title",e.target.value),placeholder:`Day ${s+1}`,className:"day-title"}),e.jsx("button",{type:"button",className:"remove-button",onClick:()=>(e=>{const a=[...m];a.splice(e,1);const s=a.map(((e,a)=>({...e,title:e.title.startsWith("Day ")?`Day ${a+1}`:e.title})));h(s)})(s),children:"Remove Day"})]}),e.jsx("textarea",{value:a.description,onChange:e=>F(s,"description",e.target.value),placeholder:"Describe activities for this day",rows:"3"})]},`day-${s}`))),e.jsx("button",{type:"button",className:"add-button",onClick:()=>{h([...m,{title:`Day ${m.length+1}`,description:""}])},children:"Add Day"})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Package Images"}),e.jsxs("div",{className:"image-upload",children:[e.jsx("input",{type:"file",id:"images",name:"images",onChange:e=>{const a=Array.from(e.target.files);g([...p,...a]);const s=a.map((e=>({url:URL.createObjectURL(e),name:e.name,isExisting:!1})));C([...w,...s])},multiple:!0,accept:"image/*"}),e.jsx("label",{htmlFor:"images",className:"file-upload-button",children:"Select Images"})]}),w.length>0&&e.jsx("div",{className:"image-previews",children:w.map(((a,s)=>e.jsxs("div",{className:"image-preview",children:[e.jsx("img",{src:a.url,alt:`Preview ${s+1}`}),e.jsx("button",{type:"button",className:"remove-image",onClick:()=>(e=>{const a=[...p],s=[...w];if(!s[e].isExisting){const t=p.findIndex((a=>a.name===s[e].name));-1!==t&&a.splice(t,1)}s.splice(e,1),g(a),C(s)})(s),children:"×"}),e.jsxs("span",{className:"image-name",children:[a.isExisting?"Existing: ":"",a.name]})]},`image-${s}`)))})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"submit-button",disabled:j,children:j?"Saving...":l?"Update Package":"Create Package"}),e.jsx("button",{type:"button",className:"cancel-button",onClick:()=>{s?s():c(-1)},children:"Cancel"})]})]})]})},d=()=>{const[s,t]=a.useState("packages"),[d,u]=a.useState(!0),[m,h]=a.useState(null),[p,g]=a.useState(null),[v,x]=a.useState(!1),j=n();a.useEffect((()=>{const e=localStorage.getItem("vendorToken");if(!e)return void j("/vendor/login");(async()=>{var a;try{u(!0),h(null);const a=await i.get("http://localhost:5000/api/vendors/profile",{headers:{Authorization:`Bearer ${e}`}});g(a.data.vendor)}catch(s){h("Failed to load vendor profile. Please try logging in again."),401===(null==(a=s.response)?void 0:a.status)&&(localStorage.removeItem("vendorToken"),localStorage.removeItem("vendorInfo"),j("/vendor/login"))}finally{u(!1)}})()}),[j]);return d?e.jsx("div",{className:"vendor-dashboard-loading",children:"Loading dashboard..."}):m?e.jsx("div",{className:"vendor-dashboard-error",children:m}):e.jsxs("div",{className:"vendor-dashboard-container",children:[e.jsxs("div",{className:"vendor-dashboard-header",children:[e.jsx("h1",{children:"Vendor Dashboard"}),e.jsxs("div",{className:"vendor-dashboard-welcome",children:["Welcome, ",(null==p?void 0:p.name)||"Vendor","!"]}),e.jsx("button",{className:"logout-button",onClick:()=>{localStorage.removeItem("vendorToken"),localStorage.removeItem("vendorInfo"),j("/vendor/login")},children:"Logout"})]}),e.jsxs("div",{className:"vendor-dashboard-content",children:[e.jsxs("div",{className:"vendor-dashboard-tabs",children:[e.jsx("button",{className:"tab-button "+("packages"===s?"active":""),onClick:()=>{t("packages"),x(!1)},children:"Tour Packages"}),e.jsx("button",{className:"tab-button "+("bookings"===s?"active":""),onClick:()=>{t("bookings"),x(!1)},children:"Bookings"}),e.jsx("button",{className:"tab-button "+("profile"===s?"active":""),onClick:()=>{t("profile"),x(!1)},children:"Profile"})]}),e.jsxs("div",{className:"vendor-dashboard-view",children:["packages"===s&&!v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"packages-header",children:[e.jsx("h2",{children:"My Tour Packages"}),e.jsx("button",{className:"add-package-button",onClick:()=>x(!0),children:"Add New Package"})]}),e.jsx(l,{})]}),"packages"===s&&v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"packages-header",children:[e.jsx("h2",{children:"Add New Package"}),e.jsx("button",{className:"back-button",onClick:()=>x(!1),children:"Back to Packages"})]}),e.jsx(c,{onSuccess:()=>x(!1)})]}),"bookings"===s&&e.jsx(o,{}),"profile"===s&&e.jsx(r,{vendorInfo:p})]})]})]})};export{d as default};
