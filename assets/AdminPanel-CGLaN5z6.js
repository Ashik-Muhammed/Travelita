import{j as e}from"./index-DbrkFvWc.js";import{r as a,L as s}from"./router-DJX9oSP-.js";import{a as t}from"./axios-rSMZb3Ae.js";import"./react-CMmhtoO5.js";function n(){const[n,c]=a.useState({totalUsers:0,totalVendors:0,totalPackages:0,totalBookings:0,pendingApprovals:0,recentPackages:[]}),[i,r]=a.useState([]),[d,l]=a.useState(!0),[o,h]=a.useState(null),[m,p]=a.useState(!1);a.useEffect((()=>{(async()=>{try{l(!0);const s=localStorage.getItem("token");if(!s)return h("Authentication required"),void l(!1);const n={headers:{Authorization:`Bearer ${s}`}};try{const e=await t.get("http://localhost:5000/api/admin/stats",n);c(e.data)}catch(e){c({totalUsers:0,totalVendors:0,totalPackages:0,totalBookings:0,pendingApprovals:0,recentPackages:[]})}try{const e=await t.get("http://localhost:5000/api/admin/packages/pending",n);r(e.data)}catch(a){r([])}l(!1)}catch(s){h("Failed to fetch admin data. Please try again."),l(!1)}})()}),[]);const x=async(e,a)=>{try{p(!0);const s=localStorage.getItem("token");await t.put(`http://localhost:5000/api/admin/packages/${e}/${a}`,{},{headers:{Authorization:`Bearer ${s}`}});r(i.filter((a=>a._id!==e))),c({...n,pendingApprovals:n.pendingApprovals-1,totalPackages:"approve"===a?n.totalPackages+1:n.totalPackages});const d=document.createElement("div");d.className="success-toast",d.textContent=`Package ${"approve"===a?"approved":"rejected"} successfully`,document.body.appendChild(d),setTimeout((()=>{d.remove()}),3e3),p(!1)}catch(s){let d=`Failed to ${a} package. Please try again.`,l=!1;s.response&&(s.response.data&&s.response.data.message&&(d=`Error: ${s.response.data.message}`),401!==s.response.status&&403!==s.response.status||(d="Your session has expired. Please log in again."),s.response.status>=500&&(l=!0,d+=" Retrying..."));const o=document.createElement("div");o.className="error-toast",o.textContent=d,document.body.appendChild(o),setTimeout((()=>{o.remove()}),5e3),l&&setTimeout((async()=>{try{const s=localStorage.getItem("token");await t.put(`http://localhost:5000/api/admin/packages/${e}/${a}`,{},{headers:{Authorization:`Bearer ${s}`}});r(i.filter((a=>a._id!==e))),c({...n,pendingApprovals:n.pendingApprovals-1,totalPackages:"approve"===a?n.totalPackages+1:n.totalPackages});const d=document.createElement("div");d.className="success-toast",d.textContent=`Package ${"approve"===a?"approved":"rejected"} successfully on retry`,document.body.appendChild(d),setTimeout((()=>{d.remove()}),3e3)}catch(s){const e=document.createElement("div");e.className="error-toast",e.textContent="Retry failed. Please refresh the page and try again.",document.body.appendChild(e),setTimeout((()=>{e.remove()}),5e3)}}),2e3),p(!1)}};return d?e.jsx("div",{className:"loading-container",children:e.jsx("div",{className:"loading-spinner"})}):o?e.jsx("div",{className:"error-container",children:e.jsxs("div",{className:"error-box",children:[e.jsx("h2",{className:"error-title",children:"Error"}),e.jsx("p",{className:"error-text",children:o}),e.jsx("button",{onClick:()=>window.location.reload(),className:"error-button",children:"Try Again"})]})}):e.jsx("div",{className:"admin-dashboard",children:e.jsxs("div",{className:"admin-container",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{className:"admin-title",children:"Admin Dashboard"}),e.jsx("p",{className:"admin-subtitle",children:"Manage your tour package platform and monitor system performance"})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsx("div",{className:"stats-card users-card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"card-inner",children:[e.jsx("div",{className:"card-icon blue",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsxs("div",{className:"card-details",children:[e.jsx("h3",{className:"card-title",children:"Total Users"}),e.jsxs("div",{className:"card-stat-row",children:[e.jsx("div",{className:"card-stat-value",children:n.totalUsers}),e.jsx(s,{to:"/admin/users",className:"card-link",children:"View all"})]})]})]})})}),e.jsx("div",{className:"stats-card vendors-card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"card-inner",children:[e.jsx("div",{className:"card-icon indigo",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),e.jsxs("div",{className:"card-details",children:[e.jsx("h3",{className:"card-title",children:"Vendors"}),e.jsxs("div",{className:"card-stat-row",children:[e.jsx("div",{className:"card-stat-value",children:n.totalVendors}),e.jsx(s,{to:"/admin/vendors",className:"card-link",children:"View all"})]})]})]})})}),e.jsx("div",{className:"stats-card packages-card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"card-inner",children:[e.jsx("div",{className:"card-icon green",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsxs("div",{className:"card-details",children:[e.jsx("h3",{className:"card-title",children:"Packages"}),e.jsxs("div",{className:"card-stat-row",children:[e.jsx("div",{className:"card-stat-value",children:n.totalPackages}),e.jsx(s,{to:"/admin/packages",className:"card-link",children:"View all"})]})]})]})})}),e.jsx("div",{className:"stats-card bookings-card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"card-inner",children:[e.jsx("div",{className:"card-icon yellow",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),e.jsxs("div",{className:"card-details",children:[e.jsx("h3",{className:"card-title",children:"Bookings"}),e.jsxs("div",{className:"card-stat-row",children:[e.jsx("div",{className:"card-stat-value",children:n.totalBookings}),e.jsx(s,{to:"/admin/bookings",className:"card-link",children:"View all"})]})]})]})})})]}),e.jsxs("div",{className:"admin-section",children:[e.jsxs("div",{className:"admin-section-header",children:[e.jsx("h2",{className:"section-title",children:"Pending Package Approvals"}),e.jsxs("span",{className:"badge badge-pending",children:[i.length," Pending"]})]}),0===i.length?e.jsx("div",{className:"section-box empty-message",children:e.jsx("p",{className:"empty-text",children:"No packages pending approval at this time."})}):e.jsx("div",{className:"section-box",children:e.jsx("ul",{className:"package-list",children:i.map((a=>{var t;return e.jsx("li",{className:"package-card",children:e.jsxs("div",{className:"package-row",children:[e.jsxs("div",{className:"package-content",children:[e.jsx("div",{className:"package-image",children:e.jsx("img",{src:a.images&&a.images.length>0?`http://localhost:5000/uploads/${a.images[0]}`:"https://via.placeholder.com/300x200?text=No+Image",alt:a.title})}),e.jsxs("div",{className:"package-details",children:[e.jsx("h3",{className:"package-title",children:a.title}),e.jsxs("div",{className:"package-info",children:[e.jsxs("span",{className:"package-meta",children:["Vendor: ",(null==(t=a.vendor)?void 0:t.name)||"Unknown"]}),e.jsx("span",{className:"package-divider",children:"•"}),e.jsxs("span",{className:"package-meta",children:["Price: ₹",a.price]}),e.jsx("span",{className:"package-divider",children:"•"}),e.jsx("span",{className:"package-meta",children:a.duration}),e.jsx("span",{className:"package-divider",children:"•"}),e.jsxs("span",{className:"package-meta",children:["Destination: ",a.destination]})]}),e.jsx("p",{className:"package-description",children:a.description})]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs(s,{to:`/packages/${a._id}`,target:"_blank",rel:"noopener noreferrer",className:"action-button view",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]}),e.jsxs("button",{onClick:()=>x(a._id,"approve"),disabled:m,className:"action-button approve",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Approve"]}),e.jsxs("button",{onClick:()=>x(a._id,"reject"),disabled:m,className:"action-button reject",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Reject"]})]})]})},a._id)}))})})]}),e.jsxs("div",{className:"admin-section",children:[e.jsx("div",{className:"admin-section-header",children:e.jsx("h2",{className:"section-title",children:"Recent Packages"})}),e.jsx("div",{className:"section-box",children:n.recentPackages&&n.recentPackages.length>0?e.jsx("ul",{className:"package-list",children:n.recentPackages.map((a=>e.jsx("li",{className:"package-card",children:e.jsxs("div",{className:"package-content",children:[e.jsx("div",{className:"package-image",children:e.jsx("img",{src:a.images&&a.images.length>0?`http://localhost:5000/uploads/${a.images[0]}`:"https://via.placeholder.com/300x200?text=No+Image",alt:a.title})}),e.jsxs("div",{className:"package-details",children:[e.jsx(s,{to:`/packages/${a._id}`,className:"package-title-link",children:a.title}),e.jsxs("div",{className:"package-info",children:[e.jsxs("span",{className:"package-meta",children:["Status:",e.jsx("span",{className:"badge "+("approved"===a.status?"badge-approved":"pending"===a.status?"badge-pending":"badge-rejected"),children:a.status})]}),e.jsx("span",{className:"package-divider",children:"•"}),e.jsxs("span",{className:"package-meta",children:["Added: ",new Date(a.createdAt).toLocaleDateString()]})]})]})]})},a._id)))}):e.jsx("div",{className:"empty-message",children:e.jsx("p",{className:"empty-text",children:"No recent packages available."})})})]}),e.jsxs("div",{className:"nav-grid",children:[e.jsx(s,{to:"/admin/users",className:"nav-card",children:e.jsxs("div",{className:"nav-card-content",children:[e.jsx("div",{className:"nav-icon purple",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsxs("div",{className:"nav-details",children:[e.jsx("h3",{className:"nav-title",children:"Manage Users"}),e.jsx("p",{className:"nav-desc",children:"View and manage user accounts and permissions"})]})]})}),e.jsx(s,{to:"/admin/packages",className:"nav-card",children:e.jsxs("div",{className:"nav-card-content",children:[e.jsx("div",{className:"nav-icon blue",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsxs("div",{className:"nav-details",children:[e.jsx("h3",{className:"nav-title",children:"Manage Packages"}),e.jsx("p",{className:"nav-desc",children:"View, edit, and delete tour packages"})]})]})})]})]})})}export{n as default};
