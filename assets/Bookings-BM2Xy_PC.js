import{j as e}from"./index-DbrkFvWc.js";import{r as a,L as s}from"./router-DJX9oSP-.js";import{a as n}from"./axios-rSMZb3Ae.js";import"./react-CMmhtoO5.js";const i=()=>{const[i,t]=a.useState([]),[o,l]=a.useState(!0),[c,r]=a.useState(null),[d,g]=a.useState("all");a.useEffect((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return void(window.location.href="/login");const a=await n.get("http://localhost:5000/api/bookings",{headers:{Authorization:`Bearer ${e}`}});t(a.data.bookings||[]),l(!1)}catch(e){r("Failed to load bookings. Please try again."),l(!1)}})()}),[]);const h=i.filter((e=>"all"===d||e.status===d));return o?e.jsx("div",{className:"loading-container",children:e.jsx("div",{className:"spinner"})}):c?e.jsxs("div",{className:"error-container",children:[e.jsx("h2",{children:"Error"}),e.jsx("p",{children:c}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Try Again"})]}):e.jsxs("div",{className:"bookings-page",children:[e.jsx("div",{className:"bookings-header",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{children:"My Bookings"}),e.jsx("p",{children:"Manage and track your tour package bookings"})]})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"bookings-filters",children:[e.jsx("button",{className:"filter-btn "+("all"===d?"active":""),onClick:()=>g("all"),children:"All Bookings"}),e.jsx("button",{className:"filter-btn "+("pending"===d?"active":""),onClick:()=>g("pending"),children:"Pending"}),e.jsx("button",{className:"filter-btn "+("confirmed"===d?"active":""),onClick:()=>g("confirmed"),children:"Confirmed"}),e.jsx("button",{className:"filter-btn "+("cancelled"===d?"active":""),onClick:()=>g("cancelled"),children:"Cancelled"})]}),h.length>0?e.jsx("div",{className:"bookings-grid",children:h.map((a=>{var o,l,c,r,d,g;return e.jsxs("div",{className:"booking-card",children:[e.jsxs("div",{className:"booking-image",children:[e.jsx("img",{src:(null==(l=null==(o=a.package)?void 0:o.images)?void 0:l[0])||"/placeholder-image.jpg",alt:(null==(c=a.package)?void 0:c.title)||"Package Image"}),e.jsx("span",{className:`status-badge ${a.status}`,children:a.status})]}),e.jsxs("div",{className:"booking-content",children:[e.jsx("h3",{children:(null==(r=a.package)?void 0:r.title)||"Package Title"}),e.jsxs("div",{className:"booking-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Booking Date:"})," ",new Date(a.bookingDate).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Travel Date:"})," ",new Date(a.travelDate).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price:"})," â‚¹",(null==(d=a.price)?void 0:d.toLocaleString())||"0"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Guests:"})," ",a.guests||1]})]}),e.jsxs("div",{className:"booking-actions",children:[e.jsx(s,{to:`/packages/${null==(g=a.package)?void 0:g._id}`,className:"btn btn-outline",children:"View Package"}),"pending"===a.status&&e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to cancel this booking?"))try{const a=localStorage.getItem("token");await n.put(`http://localhost:5000/api/bookings/${e}/cancel`,{},{headers:{Authorization:`Bearer ${a}`}}),t(i.map((a=>a._id===e?{...a,status:"cancelled"}:a)))}catch(a){alert("Failed to cancel booking. Please try again.")}})(a._id),className:"btn btn-danger",children:"Cancel Booking"})]})]})]},a._id)}))}):e.jsxs("div",{className:"no-bookings",children:[e.jsx("h2",{children:"No Bookings Found"}),e.jsx("p",{children:"all"===d?"You haven't made any bookings yet.":`No ${d} bookings found.`}),e.jsx(s,{to:"/packages",className:"btn btn-primary",children:"Browse Packages"})]})]})]})};export{i as default};
