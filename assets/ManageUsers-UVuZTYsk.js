import{c as e,d as a,g as s,j as l,f as i}from"./index-Byul4zVF.js";import{r as t}from"./router-CE_eIJm-.js";import"./react-CMmhtoO5.js";function n(){const[n,r]=t.useState([]),[c,d]=t.useState(!0),[o,h]=t.useState(null),[m,u]=t.useState(!1),[x,v]=t.useState(null),[j,g]=t.useState(""),[N,p]=t.useState("all"),[b,f]=t.useState(1),[y]=t.useState(10);t.useEffect((()=>{C()}),[]);const C=async()=>{try{d(!0);const l=JSON.parse(localStorage.getItem("user"));if(!l||"admin"!==l.role)return h("Admin authentication required"),void d(!1);const i=e(a,"users"),t=await s(i);if(t.exists()){const e=Object.entries(t.val()).map((([e,a])=>({id:e,...a,active:!1!==a.active,_id:e})));r(e)}else r([]);d(!1)}catch(l){h("Failed to fetch users. Please try again."),d(!1)}};t.useEffect((()=>{f(1)}),[j,N]);const w=n.filter((e=>{const a=(null==e?void 0:e.name)||"",s=(null==e?void 0:e.email)||"",l=a.toLowerCase().includes(j.toLowerCase())||s.toLowerCase().includes(j.toLowerCase());return"all"===N?l:"active"===N?l&&e.active:"inactive"===N?l&&!e.active:"admin"===N?l&&"admin"===e.role:"vendor"===N?l&&"vendor"===e.role:"user"===N?l&&"user"===e.role:l}));return c?l.jsx("div",{className:"loading-spinner",children:l.jsx("div",{className:"spinner"})}):o?l.jsx("div",{className:"error-container",children:l.jsxs("div",{className:"error-box",children:[l.jsx("h2",{className:"error-title",children:"Error"}),l.jsx("p",{className:"error-message",children:o}),l.jsx("button",{onClick:()=>window.location.reload(),className:"retry-button",children:"Try Again"})]})}):l.jsx("div",{className:"manage-users-container",children:l.jsxs("div",{className:"manage-users-wrapper",children:[l.jsxs("div",{className:"manage-users-header",children:[l.jsx("h1",{className:"manage-users-title",children:"Manage Users"}),l.jsx("p",{className:"manage-users-subtitle",children:"View and manage all users in the system"})]}),l.jsx("div",{className:"filters-container",children:l.jsxs("div",{className:"filters-grid",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"search",className:"sr-only",children:"Search"}),l.jsxs("div",{className:"search-container",children:[l.jsx("div",{className:"search-icon",children:l.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:l.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),l.jsx("input",{type:"text",id:"search",className:"search-input",placeholder:"Search users by name or email",value:j,onChange:e=>g(e.target.value)})]})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"filter",className:"sr-only",children:"Filter"}),l.jsxs("select",{id:"filter",className:"filter-select",value:N,onChange:e=>p(e.target.value),children:[l.jsx("option",{value:"all",children:"All Users"}),l.jsx("option",{value:"active",children:"Active"}),l.jsx("option",{value:"inactive",children:"Inactive"}),l.jsx("option",{value:"admin",children:"Admins"}),l.jsx("option",{value:"vendor",children:"Vendors"}),l.jsx("option",{value:"user",children:"Regular Users"})]})]})]})}),l.jsx("div",{className:"table-container",children:l.jsxs("div",{className:"table-scroll",children:[l.jsxs("table",{className:"users-table",children:[l.jsx("thead",{className:"table-header",children:l.jsxs("tr",{children:[l.jsx("th",{children:"Name"}),l.jsx("th",{children:"Email"}),l.jsx("th",{children:"Role"}),l.jsx("th",{children:"Status"}),l.jsx("th",{children:"Joined"}),l.jsx("th",{style:{textAlign:"right"},children:"Actions"})]})}),l.jsx("tbody",{className:"table-body",children:w.length>0?w.slice((b-1)*y,b*y).map((s=>l.jsxs("tr",{children:[l.jsx("td",{children:l.jsxs("div",{className:"user-cell",children:[l.jsx("div",{className:"user-avatar",children:s.profileImage?l.jsx("img",{src:s.profileImage,alt:s.name}):l.jsx("div",{className:"avatar-placeholder",children:s.name?s.name.charAt(0).toUpperCase():"U"})}),l.jsx("div",{className:"user-info",children:l.jsx("div",{className:"user-name",children:s.name||"Unknown User"})})]})}),l.jsx("td",{children:l.jsx("div",{className:"user-email",children:s.email||"No email"})}),l.jsx("td",{children:l.jsx("span",{className:"badge "+("admin"===s.role?"badge-admin":"vendor"===s.role?"badge-vendor":"badge-user"),children:s.role?s.role.charAt(0).toUpperCase()+s.role.slice(1):"User"})}),l.jsx("td",{children:l.jsx("span",{className:"badge "+(s.active?"badge-active":"badge-inactive"),children:s.active?"Active":"Inactive"})}),l.jsx("td",{className:"date-cell",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"Unknown date"}),l.jsx("td",{className:"actions-cell",children:x===s._id?l.jsxs("div",{className:"action-buttons",children:[l.jsxs("select",{className:"role-select",defaultValue:s.role,onChange:l=>(async(s,l)=>{try{u(!0);const t=e(a,`users/${s}`);await i(t,{role:l}),r(n.map((e=>e.id===s?{...e,role:l}:e))),u(!1),v(null)}catch(t){u(!1)}})(s._id,l.target.value),disabled:m,children:[l.jsx("option",{value:"user",children:"User"}),l.jsx("option",{value:"vendor",children:"Vendor"}),l.jsx("option",{value:"admin",children:"Admin"})]}),l.jsx("button",{onClick:()=>v(null),className:"cancel-button",disabled:m,children:"Cancel"})]}):l.jsxs("div",{className:"action-buttons",children:[l.jsx("button",{onClick:()=>v(s._id),className:"edit-button",disabled:m,children:"Edit"}),l.jsx("button",{onClick:()=>(async(s,l)=>{try{u(!0);const t=e(a,`users/${s}`);await i(t,{active:l}),r(n.map((e=>e.id===s?{...e,active:l}:e))),u(!1)}catch(t){u(!1)}})(s._id,!s.active),className:s.active?"deactivate-button":"activate-button",disabled:m,children:s.active?"Deactivate":"Activate"})]})})]},s.id))):l.jsx("tr",{children:l.jsx("td",{colSpan:"6",className:"empty-message",children:"No users found matching your search."})})})]}),w.length>0&&l.jsxs("div",{className:"pagination-container",children:[l.jsxs("div",{className:"pagination-info",children:["Showing ",Math.min((b-1)*y+1,w.length)," to ",Math.min(b*y,w.length)," of ",w.length," users"]}),l.jsxs("div",{className:"pagination-buttons",children:[l.jsx("button",{onClick:()=>f((e=>Math.max(e-1,1))),disabled:1===b,className:"pagination-button",children:"Previous"}),Array.from({length:Math.ceil(w.length/y)},((e,a)=>l.jsx("button",{onClick:()=>f(a+1),className:"pagination-page-button "+(b===a+1?"active":""),children:a+1},a+1))),l.jsx("button",{onClick:()=>f((e=>Math.min(e+1,Math.ceil(w.length/y)))),disabled:b===Math.ceil(w.length/y),className:"pagination-button",children:"Next"})]})]})]})})]})})}export{n as default};
