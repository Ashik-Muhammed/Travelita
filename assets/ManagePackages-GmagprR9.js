import{j as e}from"./index-DbrkFvWc.js";import{r as t,u as a,L as s}from"./router-DJX9oSP-.js";import{a as l}from"./axios-rSMZb3Ae.js";import"./react-CMmhtoO5.js";function r(){const[r,i]=t.useState([]),[n,d]=t.useState(!0),[c,o]=t.useState(null),[m,x]=t.useState(!1),[u,h]=t.useState(""),[g,p]=t.useState("all"),[b,v]=t.useState(""),[f,j]=t.useState(null),[y,w]=t.useState(null);a(),t.useEffect((()=>{const e=localStorage.getItem("token");if(e)try{const t=JSON.parse(atob(e.split(".")[1]));w(t.role)}catch(t){}N()}),[]),t.useEffect((()=>{if(b){const e=setTimeout((()=>{v("")}),3e3);return()=>clearTimeout(e)}}),[b]);const N=async()=>{try{d(!0);const e=localStorage.getItem("token");if(!e)return o("Authentication required"),void d(!1);const t="admin"===y?"http://localhost:5000/api/packages":"http://localhost:5000/api/vendor/packages",a=await l.get(t,{headers:{Authorization:`Bearer ${e}`}});i(a.data),d(!1)}catch(e){o("Failed to fetch packages. Please try again."),d(!1)}},k=r.filter((e=>{const t=e.title.toLowerCase().includes(u.toLowerCase())||e.destination.toLowerCase().includes(u.toLowerCase());return"all"===g?t:"active"===g?t&&e.available:"inactive"===g?t&&!e.available:"pending"===g?t&&"pending"===e.status:"rejected"===g?t&&"rejected"===e.status:t}));return n?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):c?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),e.jsx("p",{className:"text-gray-700",children:c}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Try Again"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-100 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Manage Tour Packages"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"admin"===y?"View and manage all tour packages":"View, edit, or remove your tour packages"})]}),"admin"!==y&&e.jsxs(s,{to:"/vendor/packages/add",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"-ml-1 mr-2 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})}),"Add New Package"]})]}),b&&e.jsx("div",{className:"mb-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:b})}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsx("label",{htmlFor:"search",className:"sr-only",children:"Search"}),e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),e.jsx("input",{type:"text",id:"search",className:"focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 pr-12 sm:text-sm border-gray-300 rounded-md",placeholder:"Search packages by title or destination",value:u,onChange:e=>h(e.target.value)})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"filter",className:"sr-only",children:"Filter"}),e.jsxs("select",{id:"filter",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",value:g,onChange:e=>p(e.target.value),children:[e.jsx("option",{value:"all",children:"All Packages"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending Approval"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]})]})})}),0===k.length?e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-gray-500",children:"No packages found matching your criteria."}),"admin"!==y&&e.jsx(s,{to:"/vendor/packages/add",className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Add Your First Package"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:k.map((t=>e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsxs("div",{className:"relative h-48 w-full overflow-hidden",children:[e.jsx("img",{className:"h-full w-full object-cover",src:t.images&&t.images.length>0?`http://localhost:5000/uploads/${t.images[0]}`:"https://via.placeholder.com/300x200?text=No+Image",alt:t.title}),e.jsx("div",{className:"absolute top-0 right-0 mt-2 mr-2",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("approved"===t.status?t.available?"bg-green-100 text-green-800":"bg-red-100 text-red-800":"pending"===t.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:"approved"===t.status?t.available?"Active":"Inactive":t.status.charAt(0).toUpperCase()+t.status.slice(1)})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t.title}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-gray-500",children:[e.jsxs("span",{className:"inline-block mr-3",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-400 inline mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),t.destination]}),e.jsxs("span",{className:"inline-block",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-400 inline mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),t.duration]})]}),e.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["â‚¹",t.price]})]}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:t.description})]}),f===t._id?e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("p",{className:"text-sm text-red-600 font-semibold",children:"Are you sure you want to delete this package?"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(async e=>{try{x(!0);const t=localStorage.getItem("token");await l.delete(`http://localhost:5000/api/packages/${e}`,{headers:{Authorization:`Bearer ${t}`}}),i(r.filter((t=>t._id!==e))),v("Package deleted successfully"),x(!1),j(null)}catch(t){o("Failed to delete package. Please try again."),x(!1),j(null)}})(t._id),disabled:m,className:"w-1/2 inline-flex justify-center items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-red-600 hover:bg-red-700",children:"Yes, Delete"}),e.jsx("button",{onClick:()=>j(null),className:"w-1/2 inline-flex justify-center items-center px-2.5 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(s,{to:`/packages/${t._id}`,className:"w-1/3 inline-flex justify-center items-center px-2.5 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"View"}),"admin"!==y&&e.jsx(s,{to:`/vendor/packages/edit/${t._id}`,className:"w-1/3 inline-flex justify-center items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-blue-600 hover:bg-blue-700",children:"Edit"}),"approved"===t.status&&e.jsx("button",{onClick:()=>(async(e,t)=>{try{x(!0);const a=localStorage.getItem("token");await l.put(`http://localhost:5000/api/packages/${e}/toggle-status`,{available:!t},{headers:{Authorization:`Bearer ${a}`}}),i(r.map((a=>a._id===e?{...a,available:!t}:a))),v(`Package ${t?"deactivated":"activated"} successfully`),x(!1)}catch(a){x(!1)}})(t._id,t.available),disabled:m,className:"w-1/3 inline-flex justify-center items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-white "+(t.available?"bg-orange-500 hover:bg-orange-600":"bg-green-600 hover:bg-green-700"),children:t.available?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>j(t._id),disabled:m,className:"w-1/3 inline-flex justify-center items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]},t._id)))})]})})}export{r as default};
