import{j as e,b as a,c as s,g as i,p as t,f as l}from"./index-CGBRwBly.js";import{b as n,u as r,r as o}from"./router-CbvfO1vz.js";import"./react-CMmhtoO5.js";function c(){const{packageId:c}=n(),d=r(),[m,u]=o.useState(null),[h,p]=o.useState(!0),[g,x]=o.useState(null),j=new Date;j.setDate(j.getDate()+1);const v=j.toISOString().split("T")[0],[b,k]=o.useState({fullName:"",email:"",phone:"",travelers:1,date:v,time:"09:00",duration:1,specialRequests:""}),[N,f]=o.useState(null),[w,S]=o.useState(!1),[y,D]=o.useState("");o.useEffect((()=>{const e=localStorage.getItem("user");if(e){const a=JSON.parse(e);f(a),k((e=>({...e,fullName:a.name||"",email:a.email||""})))}(async()=>{try{p(!0);const e=a(s,`packages/${c}`),t=await i(e);if(t.exists()){const e=t.val();e.id=c,u(e)}else x("Package not found");p(!1)}catch(e){x("Failed to fetch package details"),p(!1)}})()}),[c]);const q=e=>{const{name:a,value:s,type:i}=e.target;k({...b,[a]:"number"===i?parseInt(s)||1:s})},C=new Date;C.setFullYear(C.getFullYear()+1),C.toISOString().split("T")[0];return h?e.jsxs("div",{className:"booking-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading package details..."})]}):g?e.jsxs("div",{className:"booking-error",children:[e.jsx("h2",{children:"Error"}),e.jsx("p",{children:g}),e.jsx("button",{onClick:()=>d("/packages"),className:"back-button",children:"Back to Packages"})]}):m?y?e.jsxs("div",{className:"booking-success",children:[e.jsx("div",{className:"success-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"48",height:"48",children:[e.jsx("path",{d:"M0 0h24v24H0V0z",fill:"none"}),e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})]})}),e.jsx("h2",{children:"Booking Confirmed!"}),e.jsx("p",{children:y}),e.jsxs("div",{className:"success-buttons",children:[e.jsx("button",{onClick:()=>d("/user/bookings"),className:"view-bookings-button",children:"View My Bookings"}),e.jsx("button",{onClick:()=>d("/packages"),className:"browse-button",children:"Browse More Packages"})]})]}):e.jsx("div",{className:"booking-page",children:e.jsxs("div",{className:"booking-container",children:[e.jsxs("div",{className:"booking-header",children:[e.jsx("h1",{children:"Book Your Tour"}),e.jsx("button",{onClick:()=>d(`/packages/${c}`),className:"back-link",children:"← Back to Package Details"})]}),e.jsxs("div",{className:"booking-content",children:[e.jsxs("div",{className:"package-summary",children:[e.jsx("div",{className:"package-image",children:e.jsx("img",{src:m.images&&m.images.length>0?m.images[0]:"https://images.unsplash.com/photo-1501785888041-af3ef285b470?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80",alt:m.title,onError:e=>{e.target.onerror=null,e.target.src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"}})}),e.jsxs("div",{className:"package-info",children:[e.jsx("h2",{children:m.title}),e.jsxs("div",{className:"package-details",children:[e.jsxs("p",{children:[e.jsx("span",{className:"detail-label",children:"Destination:"}),e.jsx("span",{className:"detail-value",children:m.destination})]}),e.jsxs("p",{children:[e.jsx("span",{className:"detail-label",children:"Duration:"}),e.jsx("span",{className:"detail-value",children:m.duration})]}),e.jsxs("p",{children:[e.jsx("span",{className:"detail-label",children:"Price:"}),e.jsxs("span",{className:"detail-value price",children:["₹",m.price," per person"]})]})]})]})]}),e.jsxs("div",{className:"booking-form-container",children:[e.jsx("h3",{children:"Personal Information"}),e.jsxs("form",{onSubmit:async e=>{var i;if(e.preventDefault(),N)try{S(!0),x(null);const e=new Date(`${b.date}T${b.time}`),n=new Date(e);n.setHours(n.getHours()+b.duration);const r=t(a(s,"bookings")),o={packageId:c,packageName:m.title,packageImage:(null==(i=m.images)?void 0:i[0])||"",destination:m.destination||m.title,userId:N.id,userName:N.name,userEmail:N.email,...b,totalPrice:m.price*b.travelers,status:"confirmed",createdAt:(new Date).toISOString(),paymentStatus:"pending",startDate:e.toISOString(),endDate:n.toISOString(),duration:b.duration,timeLeft:Math.ceil((e-new Date)/864e5),timeLeftMs:e-new Date,timeSlot:b.time};await l(r,o);const u=a(s,`users/${N.id}/trips`),h=t(u);await l(h,{...o,bookingId:r.key,status:"upcoming",createdAt:(new Date).toISOString()}),D("Booking submitted successfully! You will receive a confirmation email shortly."),S(!1),k({fullName:N.name||"",email:N.email||"",phone:"",travelers:1,date:"",specialRequests:""}),setTimeout((()=>{d("/user/bookings")}),3e3)}catch(n){x("Failed to create booking. Please try again."),S(!1)}else x("Please log in to book a tour")},className:"booking-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"fullName",children:"Full Name"}),e.jsx("input",{type:"text",id:"fullName",name:"fullName",value:b.fullName,onChange:q,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:b.email,onChange:q,required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"date",children:"Date"}),e.jsx("input",{type:"date",id:"date",value:b.date,onChange:e=>k({...b,date:e.target.value}),min:v,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"time",children:"Start Time"}),e.jsx("input",{type:"time",id:"time",value:b.time,onChange:e=>k({...b,time:e.target.value}),min:"06:00",max:"22:00",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"duration",children:"Duration (hours)"}),e.jsx("select",{id:"duration",value:b.duration,onChange:e=>k({...b,duration:parseInt(e.target.value)}),required:!0,children:[1,2,3,4,5,6,7,8].map((a=>e.jsxs("option",{value:a,children:[a," ",1===a?"hour":"hours"]},a)))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:b.phone,onChange:q,required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"travelers",children:"Number of Travelers"}),e.jsx("input",{type:"number",id:"travelers",name:"travelers",min:"1",max:"20",value:b.travelers,onChange:q,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"date",children:"Preferred Date"}),e.jsx("input",{type:"date",id:"date",name:"date",min:(new Date).toISOString().split("T")[0],value:b.date,onChange:q,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"specialRequests",children:"Special Requests (Optional)"}),e.jsx("textarea",{id:"specialRequests",name:"specialRequests",rows:"4",value:b.specialRequests,onChange:q})]}),e.jsxs("div",{className:"booking-summary",children:[e.jsx("h3",{children:"Booking Summary"}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Package Price:"}),e.jsxs("span",{children:["₹",m.price," x ",b.travelers," travelers"]})]}),e.jsxs("div",{className:"summary-item total",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{children:["₹",m.price*b.travelers]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"book-now-button",disabled:w,children:w?"Processing...":"Confirm Booking"}),e.jsx("p",{className:"booking-note",children:'By clicking "Confirm Booking", you agree to our terms and conditions.'})]})]})]})]})]})}):e.jsxs("div",{className:"booking-error",children:[e.jsx("h2",{children:"Package Not Found"}),e.jsx("p",{children:"The requested tour package could not be found."}),e.jsx("button",{onClick:()=>d("/packages"),className:"back-button",children:"Back to Packages"})]})}export{c as default};
