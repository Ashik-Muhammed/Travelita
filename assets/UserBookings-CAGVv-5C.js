import{j as e,t as s,c as a,d as n,q as t,o as i,m as c,g as l}from"./index-DaadRvQO.js";import{r as o,u as r,L as d}from"./router-DQ2x9woV.js";import"./react-CMmhtoO5.js";function m(){const[m,g]=o.useState([]),[h,u]=o.useState(!0),[x,j]=o.useState(null),[p,N]=o.useState(null),k=r();o.useEffect((()=>{const e=localStorage.getItem("user");if(!e)return void k("/login");const s=JSON.parse(e);N(s);(async()=>{try{u(!0);const e=a(n,"bookings"),o=t(e,i("userId"),c(s.id)),r=await l(o);if(r.exists()){const e=Object.entries(r.val()).map((([e,s])=>({id:e,...s})));e.sort(((e,s)=>new Date(s.createdAt)-new Date(e.createdAt))),g(e)}else g([]);u(!1)}catch(e){j("Failed to fetch bookings. Please try again."),u(!1)}})()}),[k]);const v=e=>{switch(e){case"confirmed":return"status-confirmed";case"pending":default:return"status-pending";case"cancelled":return"status-cancelled";case"completed":return"status-completed"}},b=e=>{if(!e)return"Not specified";let s;if("number"==typeof e)s=new Date(e);else{if("string"!=typeof e)return"Invalid date";if(e.includes("T"))s=new Date(e);else{if(isNaN(Date.parse(e)))return"Invalid date";s=new Date(e)}}if(isNaN(s.getTime()))return"Invalid date";return s.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})};return h?e.jsxs("div",{className:"bookings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading your bookings..."})]}):x?e.jsxs("div",{className:"bookings-error",children:[e.jsx("h2",{children:"Error"}),e.jsx("p",{children:x}),e.jsx("button",{onClick:()=>window.location.reload(),className:"retry-button",children:"Try Again"})]}):e.jsx("div",{className:"user-bookings-page",children:e.jsxs("div",{className:"bookings-container",children:[e.jsxs("div",{className:"bookings-header",children:[e.jsx("h1",{children:"My Bookings"}),e.jsx(d,{to:"/packages",className:"browse-packages-button",children:"Browse Packages"})]}),0===m.length?e.jsxs("div",{className:"no-bookings",children:[e.jsx("div",{className:"no-bookings-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"48",height:"48",children:[e.jsx("path",{d:"M0 0h24v24H0V0z",fill:"none"}),e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"})]})}),e.jsx("h2",{children:"No Bookings Found"}),e.jsx("p",{children:"You haven't made any bookings yet."}),e.jsx(d,{to:"/packages",className:"start-booking-button",children:"Start Booking Now"})]}):e.jsx("div",{className:"bookings-list",children:m.map((a=>e.jsxs("div",{className:"booking-card",children:[e.jsx("div",{className:"booking-image",children:e.jsx("img",{src:s(a.packageImage,"travel","300x200"),alt:a.packageName||"Tour Package",className:"img-cover",onError:e=>{e.target.src=s(null,"travel","300x200")}})}),e.jsxs("div",{className:"booking-details",children:[e.jsx("h2",{className:"booking-title",children:a.packageName}),e.jsxs("div",{className:"booking-meta",children:[e.jsxs("div",{className:"booking-date",children:[e.jsx("span",{className:"meta-label",children:"Travel Date:"}),e.jsx("span",{className:"meta-value",children:b(a.date)})]}),e.jsxs("div",{className:"booking-travelers",children:[e.jsx("span",{className:"meta-label",children:"Travelers:"}),e.jsx("span",{className:"meta-value",children:a.travelers})]})]}),e.jsxs("div",{className:"booking-price",children:[e.jsx("span",{className:"meta-label",children:"Total Amount:"}),e.jsxs("span",{className:"meta-value price",children:["â‚¹",a.totalPrice]})]}),e.jsxs("div",{className:"booking-status-row",children:[e.jsxs("div",{className:"booking-created",children:[e.jsx("span",{className:"meta-label",children:"Booked on:"}),e.jsx("span",{className:"meta-value",children:b(a.createdAt)})]}),e.jsx("div",{className:"booking-status",children:e.jsx("span",{className:`status-badge ${v(a.status)}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})})]})]}),e.jsxs("div",{className:"booking-actions",children:[e.jsx(d,{to:`/packages/${a.packageId}`,className:"view-package-button",children:"View Package"}),"pending"===a.status&&e.jsx("button",{className:"cancel-booking-button",children:"Cancel Booking"}),"pending"===a.paymentStatus&&"cancelled"!==a.status&&e.jsx("button",{className:"pay-now-button",children:"Pay Now"})]})]},a.id)))})]})})}export{m as default};
