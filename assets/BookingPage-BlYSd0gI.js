import{j as e,c as s,d as a,g as l,p as i,e as n}from"./index-B_08A5P-.js";import{d as r,u as t,r as c}from"./router-CE_eIJm-.js";import"./react-CMmhtoO5.js";function o(){const{packageId:o}=r(),d=t(),[m,u]=c.useState(null),[h,p]=c.useState(!0),[g,x]=c.useState(null),[j,k]=c.useState({fullName:"",email:"",phone:"",travelers:1,date:"",specialRequests:""}),[v,N]=c.useState(null),[b,f]=c.useState(!1),[y,w]=c.useState("");c.useEffect((()=>{const e=localStorage.getItem("user");if(e){const s=JSON.parse(e);N(s),k((e=>({...e,fullName:s.name||"",email:s.email||""})))}(async()=>{try{p(!0);const e=s(a,`packages/${o}`),i=await l(e);if(i.exists()){const e=i.val();e.id=o,u(e)}else x("Package not found");p(!1)}catch(e){x("Failed to fetch package details"),p(!1)}})()}),[o]);const S=e=>{const{name:s,value:a}=e.target;k({...j,[s]:a})};return h?e.jsxs("div",{className:"booking-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading package details..."})]}):g?e.jsxs("div",{className:"booking-error",children:[e.jsx("h2",{children:"Error"}),e.jsx("p",{children:g}),e.jsx("button",{onClick:()=>d("/packages"),className:"back-button",children:"Back to Packages"})]}):m?y?e.jsxs("div",{className:"booking-success",children:[e.jsx("div",{className:"success-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"48",height:"48",children:[e.jsx("path",{d:"M0 0h24v24H0V0z",fill:"none"}),e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})]})}),e.jsx("h2",{children:"Booking Confirmed!"}),e.jsx("p",{children:y}),e.jsxs("div",{className:"success-buttons",children:[e.jsx("button",{onClick:()=>d("/user/bookings"),className:"view-bookings-button",children:"View My Bookings"}),e.jsx("button",{onClick:()=>d("/packages"),className:"browse-button",children:"Browse More Packages"})]})]}):e.jsx("div",{className:"booking-page",children:e.jsxs("div",{className:"booking-container",children:[e.jsxs("div",{className:"booking-header",children:[e.jsx("h1",{children:"Book Your Tour"}),e.jsx("button",{onClick:()=>d(`/packages/${o}`),className:"back-link",children:"← Back to Package Details"})]}),e.jsxs("div",{className:"booking-content",children:[e.jsxs("div",{className:"package-summary",children:[e.jsx("div",{className:"package-image",children:e.jsx("img",{src:m.images&&m.images.length>0?m.images[0]:"https://via.placeholder.com/300x200?text=No+Image",alt:m.title})}),e.jsxs("div",{className:"package-info",children:[e.jsx("h2",{children:m.title}),e.jsxs("div",{className:"package-details",children:[e.jsxs("p",{children:[e.jsx("span",{className:"detail-label",children:"Destination:"}),e.jsx("span",{className:"detail-value",children:m.destination})]}),e.jsxs("p",{children:[e.jsx("span",{className:"detail-label",children:"Duration:"}),e.jsx("span",{className:"detail-value",children:m.duration})]}),e.jsxs("p",{children:[e.jsx("span",{className:"detail-label",children:"Price:"}),e.jsxs("span",{className:"detail-value price",children:["₹",m.price," per person"]})]})]})]})]}),e.jsxs("div",{className:"booking-form-container",children:[e.jsx("h3",{children:"Personal Information"}),e.jsxs("form",{onSubmit:async e=>{var l;if(e.preventDefault(),v)try{f(!0);const e=s(a,"bookings"),r=i(e),t={packageId:o,packageName:m.title,packageImage:(null==(l=m.images)?void 0:l[0])||"",userId:v.id,userName:v.name,userEmail:v.email,...j,totalPrice:m.price*j.travelers,status:"pending",createdAt:(new Date).toISOString(),paymentStatus:"pending"};await n(r,t),w("Booking submitted successfully! You will receive a confirmation email shortly."),f(!1),k({fullName:v.name||"",email:v.email||"",phone:"",travelers:1,date:"",specialRequests:""}),setTimeout((()=>{d("/user/bookings")}),3e3)}catch(r){x("Failed to create booking. Please try again."),f(!1)}else d("/login",{state:{from:`/packages/${o}/book`}})},className:"booking-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"fullName",children:"Full Name"}),e.jsx("input",{type:"text",id:"fullName",name:"fullName",value:j.fullName,onChange:S,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:j.email,onChange:S,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:j.phone,onChange:S,required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"travelers",children:"Number of Travelers"}),e.jsx("input",{type:"number",id:"travelers",name:"travelers",min:"1",max:"20",value:j.travelers,onChange:S,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"date",children:"Preferred Date"}),e.jsx("input",{type:"date",id:"date",name:"date",min:(new Date).toISOString().split("T")[0],value:j.date,onChange:S,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"specialRequests",children:"Special Requests (Optional)"}),e.jsx("textarea",{id:"specialRequests",name:"specialRequests",rows:"4",value:j.specialRequests,onChange:S})]}),e.jsxs("div",{className:"booking-summary",children:[e.jsx("h3",{children:"Booking Summary"}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Package Price:"}),e.jsxs("span",{children:["₹",m.price," x ",j.travelers," travelers"]})]}),e.jsxs("div",{className:"summary-item total",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{children:["₹",m.price*j.travelers]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"book-now-button",disabled:b,children:b?"Processing...":"Confirm Booking"}),e.jsx("p",{className:"booking-note",children:'By clicking "Confirm Booking", you agree to our terms and conditions.'})]})]})]})]})]})}):e.jsxs("div",{className:"booking-error",children:[e.jsx("h2",{children:"Package Not Found"}),e.jsx("p",{children:"The requested tour package could not be found."}),e.jsx("button",{onClick:()=>d("/packages"),className:"back-button",children:"Back to Packages"})]})}export{o as default};
