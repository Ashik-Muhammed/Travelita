import{c as e,d as a,g as s,j as t,f as n,k as i}from"./index-D8mdfLhE.js";import{r as l,L as o}from"./router-DQ2x9woV.js";/* empty css                   */import"./react-CMmhtoO5.js";function d(){const[d,c]=l.useState([]),[r,h]=l.useState(!0),[u,m]=l.useState(null),[x,j]=l.useState("all"),[g,p]=l.useState(""),[N,k]=l.useState(!1),[v,b]=l.useState("");l.useEffect((()=>{y()}),[]);const y=async()=>{try{h(!0);const t=JSON.parse(localStorage.getItem("user"));if(!t||"admin"!==t.role)return m("Admin authentication required"),void h(!1);const n=e(a,"bookings"),i=await s(n);if(!i.exists())return c([]),void h(!1);const l=[];i.forEach((e=>{const a=e.val();l.push({id:e.key,...a})})),l.sort(((e,a)=>new Date(a.bookingDate)-new Date(e.bookingDate))),c(l),h(!1)}catch(t){m("Failed to fetch bookings. Please try again."),h(!1)}},f=d.filter((e=>{const a="all"===x||(x===e.status||x===e.paymentStatus),s=""===g||(e.packageTitle&&e.packageTitle.toLowerCase().includes(g.toLowerCase())||e.userName&&e.userName.toLowerCase().includes(g.toLowerCase())||e.destination&&e.destination.toLowerCase().includes(g.toLowerCase())||e.userEmail&&e.userEmail.toLowerCase().includes(g.toLowerCase()));return a&&s}));return r?t.jsx("div",{className:"loading-container",children:t.jsx("div",{className:"loading-spinner"})}):u?t.jsx("div",{className:"error-container",children:t.jsxs("div",{className:"error-box",children:[t.jsx("h2",{className:"error-title",children:"Error"}),t.jsx("p",{className:"error-text",children:u}),t.jsx("button",{onClick:()=>window.location.reload(),className:"error-button",children:"Try Again"})]})}):t.jsx("div",{className:"admin-dashboard",children:t.jsxs("div",{className:"admin-container",children:[t.jsxs("div",{className:"admin-header",children:[t.jsx("h1",{className:"admin-title",children:"Booking Management"}),t.jsx("p",{className:"admin-subtitle",children:"View and manage all bookings in the system"})]}),v&&t.jsx("div",{className:"success-message",children:v}),t.jsxs("div",{className:"admin-section",children:[t.jsxs("div",{className:"filter-container",children:[t.jsx("div",{className:"search-box",children:t.jsx("input",{type:"text",placeholder:"Search by package, user, or destination",value:g,onChange:e=>p(e.target.value),className:"search-input"})}),t.jsx("div",{className:"filter-box",children:t.jsxs("select",{value:x,onChange:e=>j(e.target.value),className:"filter-select",children:[t.jsx("option",{value:"all",children:"All Bookings"}),t.jsx("option",{value:"pending",children:"Pending Bookings"}),t.jsx("option",{value:"confirmed",children:"Confirmed Bookings"}),t.jsx("option",{value:"completed",children:"Completed Bookings"}),t.jsx("option",{value:"cancelled",children:"Cancelled Bookings"}),t.jsx("option",{value:"paid",children:"Paid Bookings"}),t.jsx("option",{value:"pending",children:"Pending Payment"})]})})]}),0===f.length?t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:"No bookings found matching your criteria."})}):t.jsx("div",{className:"bookings-table-container",children:t.jsxs("table",{className:"bookings-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Booking ID"}),t.jsx("th",{children:"Package"}),t.jsx("th",{children:"User"}),t.jsx("th",{children:"Date"}),t.jsx("th",{children:"Amount"}),t.jsx("th",{children:"Status"}),t.jsx("th",{children:"Payment"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:f.map((s=>t.jsxs("tr",{children:[t.jsx("td",{children:s.id?s.id.substring(0,8):"N/A"}),t.jsx("td",{children:t.jsxs("div",{className:"package-info",children:[t.jsx("span",{className:"package-title",children:s.packageTitle||"Unknown Package"}),t.jsx("span",{className:"package-destination",children:s.destination||"Unknown"})]})}),t.jsx("td",{children:t.jsxs("div",{className:"user-info",children:[t.jsx("span",{className:"user-name",children:s.userName||"Unknown User"}),t.jsx("span",{className:"user-email",children:s.userEmail||"No email"})]})}),t.jsx("td",{children:t.jsxs("div",{className:"date-info",children:[t.jsx("span",{className:"booking-date",children:new Date(s.bookingDate).toLocaleDateString()}),t.jsxs("span",{className:"travel-dates",children:[new Date(s.startDate).toLocaleDateString()," - ",new Date(s.endDate).toLocaleDateString()]})]})}),t.jsxs("td",{children:["â‚¹",Number(s.totalPrice).toLocaleString()]}),t.jsx("td",{children:t.jsxs("div",{className:"status-cell",children:[t.jsx("span",{className:`status-badge ${s.status}`,children:s.status}),t.jsxs("select",{value:s.status,onChange:t=>(async(s,t)=>{try{k(!0);const i=e(a,`bookings/${s}`);await n(i,{status:t,updatedAt:(new Date).toISOString()}),c(d.map((e=>e.id===s?{...e,status:t}:e))),b(`Booking status updated to ${t}`),k(!1),setTimeout((()=>b("")),3e3)}catch(i){m("Failed to update booking status. Please try again."),k(!1)}})(s.id,t.target.value),disabled:N,className:"status-select",children:[t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"confirmed",children:"Confirmed"}),t.jsx("option",{value:"completed",children:"Completed"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})}),t.jsx("td",{children:t.jsxs("div",{className:"payment-cell",children:[t.jsx("span",{className:`payment-badge ${s.paymentStatus}`,children:s.paymentStatus}),t.jsxs("select",{value:s.paymentStatus,onChange:t=>(async(s,t)=>{try{k(!0);const i=e(a,`bookings/${s}`);await n(i,{paymentStatus:t,updatedAt:(new Date).toISOString()}),c(d.map((e=>e.id===s?{...e,paymentStatus:t}:e))),b(`Payment status updated to ${t}`),k(!1),setTimeout((()=>b("")),3e3)}catch(i){m("Failed to update payment status. Please try again."),k(!1)}})(s.id,t.target.value),disabled:N,className:"payment-select",children:[t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"paid",children:"Paid"}),t.jsx("option",{value:"refunded",children:"Refunded"}),t.jsx("option",{value:"failed",children:"Failed"})]})]})}),t.jsx("td",{children:t.jsxs("div",{className:"action-buttons",children:[t.jsx(o,{to:`/packages/${s.packageId}`,className:"view-button",target:"_blank",rel:"noopener noreferrer",children:"View Package"}),t.jsx("button",{onClick:()=>(async s=>{if(window.confirm("Are you sure you want to delete this booking? This action cannot be undone."))try{k(!0);const t=e(a,`bookings/${s}`);await i(t),c(d.filter((e=>e.id!==s))),b("Booking deleted successfully"),k(!1),setTimeout((()=>b("")),3e3)}catch(t){m("Failed to delete booking. Please try again."),k(!1)}})(s.id),disabled:N,className:"delete-button",children:"Delete"})]})})]},s.id||`booking-${Math.random()}`)))})]})})]}),t.jsx("div",{className:"admin-footer",children:t.jsx(o,{to:"/admin",className:"back-button",children:"Back to Dashboard"})})]})})}export{d as default};
