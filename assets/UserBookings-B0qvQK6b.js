import{j as e,x as s,c as a,d as n,q as t,o as i,k as l,g as c}from"./index-CTnmfCPK.js";import{r,u as o,L as d}from"./router-CbvfO1vz.js";import"./react-CMmhtoO5.js";function m(){const[m,g]=r.useState([]),[h,u]=r.useState(!0),[x,j]=r.useState(null),[N,p]=r.useState(null),v=o();r.useEffect((()=>{const e=localStorage.getItem("user");if(!e)return void v("/login");const s=JSON.parse(e);p(s);(async()=>{try{u(!0);const e=a(n,"bookings"),r=t(e,i("userId"),l(s.id)),o=await c(r);if(o.exists()){const e=Object.entries(o.val()).map((([e,s])=>({id:e,...s})));e.sort(((e,s)=>new Date(s.createdAt)-new Date(e.createdAt))),g(e)}else g([]);u(!1)}catch(e){j("Failed to fetch bookings. Please try again."),u(!1)}})()}),[v]);const b=e=>{switch(e){case"confirmed":return"status-confirmed";case"pending":default:return"status-pending";case"cancelled":return"status-cancelled";case"completed":return"status-completed"}},k=e=>{if(!e)return"Not specified";let s;if("number"==typeof e)s=new Date(e);else{if("string"!=typeof e)return"Invalid date";if(e.includes("T"))s=new Date(e);else{if(isNaN(Date.parse(e)))return"Invalid date";s=new Date(e)}}if(isNaN(s.getTime()))return"Invalid date";return s.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})};return h?e.jsxs("div",{className:"bookings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading your bookings..."})]}):x?e.jsxs("div",{className:"bookings-error",children:[e.jsx("h2",{children:"Error"}),e.jsx("p",{children:x}),e.jsx("button",{onClick:()=>window.location.reload(),className:"retry-button",children:"Try Again"})]}):e.jsx("div",{className:"user-bookings-page",children:e.jsxs("div",{className:"bookings-container",children:[e.jsxs("div",{className:"bookings-header",children:[e.jsx("h1",{children:"My Bookings"}),e.jsx(d,{to:"/packages",className:"browse-packages-button",children:"Browse Packages"})]}),0===m.length?e.jsxs("div",{className:"no-bookings",children:[e.jsx("div",{className:"no-bookings-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"48",height:"48",children:[e.jsx("path",{d:"M0 0h24v24H0V0z",fill:"none"}),e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"})]})}),e.jsx("h2",{children:"No Bookings Found"}),e.jsx("p",{children:"You haven't made any bookings yet."}),e.jsx(d,{to:"/packages",className:"start-booking-button",children:"Start Booking Now"})]}):e.jsx("div",{className:"bookings-list",children:m.map((a=>{var n;return e.jsxs("div",{className:"booking-card",children:[e.jsx("div",{className:"booking-image",children:e.jsx("img",{src:s(a.packageImage,"travel","300x200"),alt:a.packageName||"Tour Package",className:"img-cover",onError:e=>{e.target.src=s(null,"travel","300x200")}})}),e.jsxs("div",{className:"booking-details",children:[e.jsxs("div",{className:"booking-header",children:[e.jsx("h2",{className:"booking-title",children:a.packageName||"Tour Package"}),e.jsx("span",{className:`status-badge ${b(a.status)}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]}),e.jsxs("div",{className:"booking-meta",children:[e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"Booking ID:"}),e.jsx("span",{className:"meta-value",children:a.id.substring(0,8)})]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"Travel Date:"}),e.jsx("span",{className:"meta-value",children:k(a.startDate||a.date)}),a.endDate&&e.jsxs("span",{className:"meta-value",children:[" to ",k(a.endDate)]})]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"Travelers:"}),e.jsxs("span",{className:"meta-value",children:[a.guests||a.travelers||1," person(s)"]})]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"Total Amount:"}),e.jsxs("span",{className:"meta-value price",children:["â‚¹",(null==(n=a.totalPrice)?void 0:n.toLocaleString())||"0.00"]})]})]}),e.jsxs("div",{className:"booking-footer",children:[e.jsxs("div",{className:"booking-created",children:[e.jsx("span",{className:"meta-label",children:"Booked on:"}),e.jsx("span",{className:"meta-value",children:k(a.createdAt)})]}),a.confirmedAt&&e.jsxs("div",{className:"confirmation-details",children:[e.jsxs("span",{className:"meta-label",children:["admin"===a.confirmedBy?"Confirmed by Admin":"Confirmed by Vendor",":"]}),e.jsx("span",{className:"meta-value",children:new Date(a.confirmedAt).toLocaleString()})]})]})]}),e.jsxs("div",{className:"booking-actions",children:[e.jsx(d,{to:`/packages/${a.packageId}`,className:"view-package-button",children:"View Package"}),"pending"===a.status&&e.jsx("button",{className:"cancel-booking-button",children:"Cancel Booking"}),"pending"===a.paymentStatus&&"cancelled"!==a.status&&e.jsx("button",{className:"pay-now-button",children:"Pay Now"})]})]},a.id)}))})]})})}export{m as default};
