import{j as e}from"./index-DbrkFvWc.js";import{d as a,r as s}from"./router-DJX9oSP-.js";import{a as t}from"./axios-rSMZb3Ae.js";import"./react-CMmhtoO5.js";const i=()=>e.jsx("span",{className:"icon-style",children:"📍"}),n=()=>e.jsx("span",{className:"icon-style",children:"🕒"}),c=()=>{const{packageId:c}=a(),[r,l]=s.useState(null),[o,d]=s.useState(!0),[p,g]=s.useState(null),[h,m]=s.useState(0),[u,j]=s.useState(!1),[x,k]=s.useState(null),[N,f]=s.useState(!1);if(s.useEffect((()=>{c&&(async()=>{try{d(!0),g(null);const a=await fetch(`http://localhost:5000/api/packages/${c}`);if(!a.ok){let s=`Failed to fetch package details (status: ${a.status})`;try{const e=await a.json();e&&e.message&&(s=e.message)}catch(e){}throw new Error(s)}const s=await a.json();l(s)}catch(a){g(a.message||"Failed to fetch package")}finally{d(!1)}})()}),[c]),o)return e.jsx("div",{className:"package-details-loading",children:e.jsx("div",{className:"spinner"})});if(p)return e.jsxs("div",{className:"container package-details-error",children:["Error: ",p]});if(!r)return e.jsx("div",{className:"container package-details-error",children:"Package not found."});const{title:b,description:v,destination:y,duration:S,price:w,images:I=[],included:$=[],itinerary:B=[],available:C}=r,E=I.length>0?`http://localhost:5000/uploads/${I[h]}`:"https://via.placeholder.com/800x500?text=No+Image",P=!1!==C;return e.jsx("div",{className:"container package-details-container",children:e.jsxs("div",{className:"package-details-content",children:[e.jsxs("div",{className:"package-image-gallery",children:[e.jsx("img",{src:E,alt:b,className:"main-package-image"}),I.length>1&&e.jsx("div",{className:"package-image-thumbnails",children:I.map(((a,s)=>e.jsx("img",{src:`http://localhost:5000/uploads/${a}`,alt:`${b} thumbnail ${s+1}`,className:s===h?"active-thumbnail":"",onClick:()=>m(s)},s)))})]}),e.jsxs("div",{className:"package-info",children:[e.jsx("h1",{children:b}),e.jsxs("div",{className:"package-meta",children:[e.jsxs("p",{children:[e.jsx(i,{})," ",e.jsx("strong",{children:"Destination:"})," ",y]}),e.jsxs("p",{children:[e.jsx(n,{})," ",e.jsx("strong",{children:"Duration:"})," ",S]}),e.jsxs("p",{className:"package-price-tag",style:{fontSize:"1.5rem",color:"var(--secondary-color)",fontWeight:"bold",marginTop:"1rem"},children:["Price: ₹",w.toLocaleString()]})]}),e.jsx("p",{className:"description",children:v}),e.jsx("div",{className:"package-booking-section",children:P?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:async()=>{j(!0),k(null),f(!1);try{const e=localStorage.getItem("token");if(!e)return void k("You must be logged in to book a package.");const a={headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}},s=e.split("."),i=JSON.parse(atob(s[1])),n={userId:i.userId,packageId:c,customerName:i.name||"Customer",price:r.price},l=await t.post("http://localhost:5000/api/bookings",n,a);201===l.status?f(!0):k(l.data.message||"Booking failed. Please try again.")}catch(e){e.response&&e.response.data&&e.response.data.message?k(e.response.data.message+(e.response.data.details?` (${e.response.data.details})`:"")):e.request?k("Booking request failed. Server might be down or unreachable."):k("An unexpected error occurred during booking.")}finally{j(!1)}},disabled:u||N,className:"book-now-button",children:u?"Processing...":N?"Booked!":"Book Now"}),x&&e.jsxs("p",{className:"booking-error-message",children:["Error: ",x]}),N&&e.jsx("p",{className:"booking-success-message",children:"Booking successful! You will be contacted shortly."})]}):e.jsx("p",{className:"package-unavailable-message",children:"This package is currently unavailable for booking."})}),$.length>0&&e.jsxs("div",{className:"package-section included-items",children:[e.jsx("h3",{children:"What's Included:"}),e.jsx("ul",{children:$.map(((a,s)=>e.jsx("li",{children:a},s)))})]}),B.length>0&&e.jsxs("div",{className:"package-section itinerary",children:[e.jsx("h3",{children:"Itinerary:"}),B.map(((a,s)=>e.jsxs("div",{className:"itinerary-day",children:[e.jsxs("h4",{children:["Day ",s+1,": ",a.title]}),e.jsx("p",{children:a.description})]},s)))]})]})]})})};export{c as default};
