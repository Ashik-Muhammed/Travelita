import{j as e,t as s}from"./index-CGBRwBly.js";import{r as a}from"./router-CbvfO1vz.js";import"./react-CMmhtoO5.js";const l=()=>{const[l,i]=a.useState([]),[n,t]=a.useState(!0),[c,d]=a.useState(""),[r,o]=a.useState(""),[m,u]=a.useState("all"),[h,j]=a.useState(1);a.useEffect((()=>{(async()=>{try{const e=await s.get("bookings")||{},a=await s.get("users")||{},l=Object.entries(e).map((([e,s])=>{const l=a[s.userId];return{id:e,...s,user:l||null}})).sort(((e,s)=>new Date(s.createdAt)-new Date(e.createdAt)));i(l)}catch(e){d("Failed to load bookings")}finally{t(!1)}})()}),[]);const x=l.filter((e=>{const s=e.bookingId&&e.bookingId.toLowerCase().includes(r)||e.packageName&&e.packageName.toLowerCase().includes(r)||e.user&&e.user.email&&e.user.email.toLowerCase().includes(r)||e.user&&e.user.displayName&&e.user.displayName.toLowerCase().includes(r),a="all"===m||e.status===m;return s&&a})),g=10*h,v=g-10,N=x.slice(v,g),p=Math.ceil(x.length/10),b=e=>j(e),k=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return n?e.jsx("div",{className:"admin-bookings",children:"Loading bookings..."}):c?e.jsx("div",{className:"error-message",children:c}):e.jsxs("div",{className:"admin-bookings",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h2",{children:"Manage Bookings"}),e.jsxs("div",{className:"filters",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Search bookings...",value:r,onChange:e=>{o(e.target.value.toLowerCase()),j(1)}}),e.jsx("i",{className:"fas fa-search"})]}),e.jsx("div",{className:"status-filter",children:e.jsxs("select",{value:m,onChange:e=>{u(e.target.value),j(1)},children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]})]}),e.jsxs("div",{className:"bookings-summary",children:[e.jsxs("div",{className:"summary-card total",children:[e.jsx("h3",{children:"Total Bookings"}),e.jsx("div",{className:"value",children:l.length})]}),e.jsxs("div",{className:"summary-card pending",children:[e.jsx("h3",{children:"Pending"}),e.jsx("div",{className:"value",children:l.filter((e=>"pending"===e.status)).length})]}),e.jsxs("div",{className:"summary-card confirmed",children:[e.jsx("h3",{children:"Confirmed"}),e.jsx("div",{className:"value",children:l.filter((e=>"confirmed"===e.status)).length})]}),e.jsxs("div",{className:"summary-card revenue",children:[e.jsx("h3",{children:"Total Revenue"}),e.jsx("div",{className:"value",children:k(l.reduce(((e,s)=>e+(s.totalPrice||0)),0))})]})]}),0===x.length?e.jsx("div",{className:"no-results",children:"No bookings found"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bookings-table-container",children:e.jsxs("table",{className:"bookings-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Booking ID"}),e.jsx("th",{children:"Package"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Guests"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:N.map((a=>{var n,t;return e.jsxs("tr",{children:[e.jsxs("td",{className:"booking-id",children:["#",a.id.substring(0,8)]}),e.jsxs("td",{className:"package",children:[e.jsx("div",{className:"package-name",children:a.packageName||"N/A"}),e.jsx("div",{className:"package-dates",children:a.travelDate||"Date not specified"})]}),e.jsxs("td",{className:"customer",children:[e.jsx("div",{className:"customer-name",children:(null==(n=a.user)?void 0:n.displayName)||"Guest User"}),e.jsx("div",{className:"customer-email",children:(null==(t=a.user)?void 0:t.email)||a.email||"No email"})]}),e.jsx("td",{className:"date",children:new Date(a.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"guests",children:[a.adults+(a.children||0)," ",a.adults+(a.children||0)===1?"Person":"People"]}),e.jsx("td",{className:"amount",children:k(a.totalPrice||0)}),e.jsx("td",{className:"status",children:e.jsx("span",{className:`status-badge ${a.status||"pending"}`,children:a.status||"Pending"})}),e.jsxs("td",{className:"actions",children:[e.jsx("div",{className:"status-actions",children:e.jsxs("select",{value:a.status||"pending",onChange:e=>(async(e,a)=>{try{await s.update(`bookings/${e}`,{status:a}),i(l.map((s=>s.id===e?{...s,status:a}:s)))}catch(n){d("Failed to update booking status")}})(a.id,e.target.value),className:`status-select ${a.status||"pending"}`,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})}),e.jsx("button",{className:"view-btn",onClick:()=>{},title:"View Details",children:e.jsx("i",{className:"fas fa-eye"})})]})]},a.id)}))})]})}),p>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>b(1),disabled:1===h,className:"page-nav",children:"«"}),e.jsx("button",{onClick:()=>b(h-1),disabled:1===h,className:"page-nav",children:"‹"}),Array.from({length:Math.min(5,p)},((s,a)=>{let l;return l=p<=5||h<=3?a+1:h>=p-2?p-4+a:h-2+a,e.jsx("button",{onClick:()=>b(l),className:"page-number "+(h===l?"active":""),children:l},l)})),e.jsx("button",{onClick:()=>b(h+1),disabled:h===p,className:"page-nav",children:"›"}),e.jsx("button",{onClick:()=>b(p),disabled:h===p,className:"page-nav",children:"»"})]})]})]})};export{l as default};
