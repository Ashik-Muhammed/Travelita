import{j as e,u as s,h as a,d as t,a as i,t as n,y as r,z as l,b as c,v as o}from"./index-CGBRwBly.js";import{r as d,u as h,L as m}from"./router-CbvfO1vz.js";import{l as p,m as x,n as u,c as j,o as g,F as N,i as y,p as v,q as b,r as f}from"./index-Crxxp2-0.js";import{m as w}from"./index-DTT3O808.js";import"./react-CMmhtoO5.js";import"./iconBase-YQ9d7kAD.js";const D=({className:s="",width:a="100%",height:t="200px"})=>e.jsx("div",{className:`bg-gray-100 flex items-center justify-center text-gray-400 ${s}`,style:{width:a,height:t},children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"opacity-50",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]})}),k=()=>{var k,S;const[U,C]=d.useState([]),[L,T]=d.useState(!0),[R,$]=d.useState(!1),[z,I]=d.useState(!1),[E,P]=d.useState(""),[F,M]=d.useState({displayName:"",photoFile:null,photoURL:""}),[B,A]=d.useState(""),[q,G]=d.useState(""),[O,H]=d.useState(!1),[W,J]=d.useState(null),[V,Y]=d.useState(""),[K,Q]=d.useState({days:0,nights:0}),X=h(),{currentUser:Z,logout:_}=s(),{refreshUser:ee}=a(),{getUserBookings:se}=a(),ae=e=>{if(!e)return"Date not set";const s=new Date(e),a=new Date;a.setHours(0,0,0,0);const t=new Date(a);t.setDate(t.getDate()+1);const i=s.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!0});if(s.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"}),s.toDateString()===a.toDateString())return`Today at ${i}`;if(s.toDateString()===t.toDateString())return`Tomorrow at ${i}`;if(s>a){const e=s-a,t=Math.ceil(e/864e5);return`in ${t} day${t>1?"s":""}`}return s.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},te=e=>{if(!e)return"upcoming";const s=new Date(e),a=new Date;return a.setHours(0,0,0,0),s<a?"completed":s.toDateString()===a.toDateString()?"today":"upcoming"},ie=U.filter((e=>{if(!e.date)return!1;const s=new Date(e.date),a=new Date;a.setHours(0,0,0,0);const t=new Date;return t.setDate(a.getDate()+90),s>=a&&s<=t})).sort(((e,s)=>new Date(e.date)-new Date(s.date))),ne=[...U].filter((e=>e.date)).sort(((e,s)=>new Date(s.date)-new Date(e.date))).slice(0,3),re=d.useCallback((async()=>{try{await t(i),X("/")}catch(e){}}),[X]),le=d.useCallback((async()=>{if(Z)try{const e=await n.get(`users/${Z.uid}`);e&&(M((s=>({...s,displayName:e.displayName||"",photoURL:e.photoURL||""}))),P(e.photoURL||""));const s=await n.get(`users/${Z.uid}/trips`);if(s){const e=Object.entries(s).map((([e,s])=>({id:e,...s}))),a=new Date,t=new Date;t.setDate(a.getDate()+30);const i=e.filter((e=>{const s=new Date(e.startDate);return s>a&&s<=t}));C(i)}}catch(e){A("Failed to load user data")}finally{T(!1)}}),[Z]),ce=e=>{if(!e.startDate)return"";const s=new Date,a=new Date(e.startDate)-s;if(a<=0)return"Trip in progress";const t=Math.floor(a/864e5),i=Math.floor(a%864e5/36e5),n=Math.floor(a%36e5/6e4);return t>1?`${t} days, ${i} hours left`:1===t?`1 day, ${i} hours left`:i>0?`${i}h ${n}m left`:`${n} minutes left`},oe=d.useCallback((()=>{if(!U||0===U.length)return;const e=new Date,s=U.filter((s=>new Date(s.startDate)>e)).sort(((e,s)=>new Date(e.startDate)-new Date(s.startDate)));if(s.length>0){const a=s[0];J(a);const t=new Date(a.startDate)-e;if(t>0){const e=Math.floor(t/864e5),s=Math.floor(t%864e5/36e5),a=Math.floor(t%36e5/6e4);Y(`${e>0?`${e}d `:""}${s}h ${a}m`)}}}),[U]),de=d.useCallback((e=>{if(!e||!e.length)return{days:0,nights:0};let s=0,a=0;return e.forEach((e=>{const t=[e.packageName||"",e.description||"",e.durationText||""].join(" "),i=[...t.matchAll(/(\d+)\s*days?\s*,\s*(\d+)\s*nights?/gi)];if(i.length>0)i.forEach((e=>{const t=parseInt(e[1],10)||0,i=parseInt(e[2],10)||0;s+=t,a+=i}));else{const e=t.match(/(\d+)\s*days?/i),i=t.match(/(\d+)\s*nights?/i),n=e?parseInt(e[1],10):0,r=i?parseInt(i[1],10):0;n>0||r>0?(s+=n||r+1,a+=r||(n>0?n-1:0)):s+=1}})),{days:s,nights:a}}),[]);d.useEffect((()=>{oe();const e=setInterval(oe,6e4);return()=>clearInterval(e)}),[oe]),d.useCallback((async()=>{if(Z){T(!0);try{const e=await se(Z.uid);C(e);const s=[...e].sort(((e,s)=>new Date(s.createdAt)-new Date(e.createdAt))).slice(0,5);setRecentBookings(s);const{days:a,nights:t}=de(e);Q({days:a,nights:t}),oe()}catch(e){setError("Failed to load bookings. Please try again.")}finally{T(!1)}}}),[Z,se,oe]);d.useEffect((()=>{le()}),[le]);const he=()=>{M({displayName:(null==Z?void 0:Z.displayName)||"",photoURL:(null==Z?void 0:Z.photoURL)||""}),P((null==Z?void 0:Z.photoURL)||""),I(!0)};return d.useEffect((()=>{(async()=>{try{const e=await se();if(C(e||[]),e&&e.length>0){const s=(e=>{let s=0,a=0;return e.forEach((e=>{if(e.duration){const t=e.duration.match(/(\d+)\s*day/i),i=e.duration.match(/(\d+)\s*night/i);t&&(s+=parseInt(t[1],10)),i&&(a+=parseInt(i[1],10))}})),s>0&&0===a&&(a=s-1),{days:s,nights:a}})(e);Q(s)}else Q({days:0,nights:0})}catch(e){}finally{T(!1)}})()}),[se]),e.jsxs("div",{className:"dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsxs("div",{className:"dashboard-header-content",children:[e.jsxs("div",{className:"welcome-section",children:[e.jsxs("h1",{children:["Welcome back, ",(null==(k=null==Z?void 0:Z.displayName)?void 0:k.split(" ")[0])||"Explorer","! ğŸ‘‹"]}),e.jsx("p",{children:"Here's what's happening with your travel plans"})]}),e.jsxs("div",{className:"quick-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(p,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{children:U.length}),e.jsx("p",{children:"Upcoming Trips"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(x,{size:24})}),e.jsxs("div",{children:[e.jsxs("h3",{children:[K.days," days, ",K.nights," nights"]}),e.jsx("p",{children:"Total Trip Duration"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(u,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{children:U.length}),e.jsx("p",{children:"Total Bookings"})]})]})]})]})}),e.jsxs("div",{className:"dashboard-container",children:[e.jsxs("div",{className:"dashboard-main",children:[e.jsxs("section",{className:"dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"Upcoming Trips"}),e.jsx(m,{to:"/tours",className:"btn-link",children:"Explore More Tours"})]}),L?e.jsx("div",{className:"loading-state",children:"Loading your trips..."}):ie.length>0?e.jsx("div",{className:"booking-cards",children:ie.map((s=>e.jsxs("div",{className:`booking-card ${te(s.date)}`,children:[e.jsx("div",{className:"booking-image",style:{backgroundImage:`url(${s.packageImage||"/placeholder-tour.jpg"})`},children:e.jsxs("div",{className:"trip-status",children:["today"===te(s.date)&&"Today","upcoming"===te(s.date)&&formatDate(s.date),"completed"===te(s.date)&&"Completed"]})}),e.jsxs("div",{className:"booking-details",children:[e.jsxs("div",{className:"booking-header",children:[e.jsx("h3",{children:s.packageName}),e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})]}),e.jsxs("div",{className:"booking-meta",children:[e.jsxs("span",{children:[e.jsx(p,{className:"icon"})," ",new Date(s.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("span",{children:[e.jsx(j,{className:"icon"})," ",s.travelers," traveler",s.travelers>1?"s":""]}),s.specialRequests&&e.jsxs("span",{className:"special-request",children:[e.jsx(FiMessageCircle,{className:"icon"})," Special request"]})]}),e.jsxs("div",{className:"booking-actions",children:[e.jsx(m,{to:`/bookings/${s.id}`,className:"btn btn-outline btn-sm",children:"View Details"}),"today"===te(s.date)&&e.jsx(m,{to:`/tours/${s.tourId||"tour"}`,className:"btn btn-primary btn-sm",children:"Start Trip"})]})]})]},s.id)))}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-illustration",children:e.jsx(w,{size:48,className:"text-muted"})}),e.jsx("h3",{children:"No Upcoming Trips"}),e.jsx("p",{children:"You don't have any trips planned in the next 30 days."}),e.jsx(m,{to:"/tours",className:"btn btn-primary",children:"Browse Tours"})]})]}),e.jsxs("section",{className:"dashboard-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h2",{children:"Recent Activity"})}),e.jsxs("div",{className:"upcoming-bookings",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Upcoming Trips"}),W&&e.jsxs("div",{className:"next-trip-countdown",children:[e.jsx("span",{className:"countdown-label",children:"Next trip in:"}),e.jsx("span",{className:"countdown-timer",children:V})]})]}),W&&e.jsx("div",{className:"next-trip-highlight",children:e.jsxs("div",{className:"next-trip-card",children:[e.jsxs("div",{className:"trip-image",children:[W.packageImage?e.jsx("img",{src:W.packageImage,alt:W.packageName,onError:e=>{e.target.style.display="none",e.target.nextElementSibling.style.display="flex"}}):null,e.jsx(D,{className:"trip-placeholder"}),e.jsx("div",{className:"trip-overlay",children:e.jsx("span",{className:"badge",children:"Next Up"})})]}),e.jsxs("div",{className:"trip-content",children:[e.jsx("h4",{children:W.packageName}),e.jsxs("div",{className:"trip-meta",children:[e.jsxs("span",{className:"trip-date",children:[e.jsx(p,{})," ",ae(W.startDate)]}),W.duration&&e.jsxs("span",{className:"trip-duration",children:[e.jsx(x,{})," ",W.duration," ",1===W.duration?"hour":"hours"]})]}),e.jsxs("div",{className:"trip-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.min(100,(new Date(W.startDate)-new Date)/(new Date(W.startDate)-new Date(W.createdAt||new Date))*100)}%`}})}),e.jsxs("div",{className:"progress-labels",children:[e.jsx("span",{children:"Booked"}),e.jsx("span",{children:"Departure"})]})]})]})]})}),U.length>1&&e.jsxs("div",{className:"other-trips",children:[e.jsx("h4",{children:"Other Upcoming Trips"}),L?e.jsx("div",{className:"loading",children:"Loading trips..."}):0===U.length?e.jsx("div",{className:"no-trips",children:"No upcoming trips in the next 30 days"}):e.jsx("div",{className:"upcoming-trips",children:U.map((s=>e.jsxs("div",{className:"trip-card",children:[e.jsxs("div",{className:"trip-image",children:[s.packageImage?e.jsx("img",{src:s.packageImage,alt:s.packageName,onError:e=>{e.target.style.display="none",e.target.nextElementSibling.style.display="flex"}}):null,e.jsx(D,{className:"trip-placeholder"})]}),e.jsxs("div",{className:"trip-details",children:[e.jsx("h3",{children:s.packageName}),e.jsxs("div",{className:"trip-meta",children:[e.jsxs("span",{className:"trip-date",children:[e.jsx(p,{})," ",ae(s.startDate)]}),s.timeSlot&&e.jsxs("span",{className:"trip-time",children:[e.jsx(x,{})," ",s.timeSlot]}),s.duration&&e.jsxs("span",{className:"trip-duration",children:[e.jsx(x,{})," ",s.duration," ",1===s.duration?"hour":"hours"]})]}),e.jsx("div",{className:"time-left",children:e.jsx("span",{className:"badge",children:ce(s)})}),e.jsxs("div",{className:"trip-actions",children:[e.jsx("button",{className:"btn btn-sm btn-outline cancel-trip-btn",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to cancel this trip? This action cannot be undone."))try{H(e);const s=l(),a=c(s,`bookings/${e}`);await o(a),C((s=>s.filter((s=>s.id!==e)))),setRecentBookings((s=>s.filter((s=>s.id!==e)))),G("Trip cancelled successfully!"),setTimeout((()=>G("")),3e3)}catch(s){A("Failed to cancel trip. Please try again."),setTimeout((()=>A("")),3e3)}finally{H(!1)}})(s.id),disabled:O===s.id,children:O===s.id?"Cancelling...":"Cancel Trip"}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>X(`/booking/${s.id}`),children:"View Details"})]})]})]},s.id)))})]})]}),ne.length>0?e.jsx("div",{className:"activity-feed",children:ne.map(((s,a)=>e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:e.jsx(p,{size:20})}),e.jsxs("div",{className:"activity-content",children:[e.jsxs("p",{children:["You booked ",e.jsx("strong",{children:s.tourName})]}),e.jsx("span",{className:"activity-time",children:formatDate(s.date)})]})]},a)))}):e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No recent activity to show"})})]})]}),e.jsxs("aside",{className:"dashboard-sidebar",children:[e.jsxs("div",{className:"profile-card",children:[e.jsxs("div",{className:"profile-header",children:[e.jsxs("div",{className:"profile-avatar",onClick:he,children:[(null==Z?void 0:Z.photoURL)?e.jsx("img",{src:Z.photoURL,alt:Z.displayName||"User"}):e.jsx("div",{className:"avatar-placeholder",children:e.jsx(j,{size:32})}),e.jsx("div",{className:"edit-overlay",children:e.jsx(g,{size:20})})]}),e.jsx("h3",{children:(null==Z?void 0:Z.displayName)||"Travel Enthusiast"}),e.jsx("p",{className:"text-muted",children:null==Z?void 0:Z.email}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:he,children:[e.jsx(g,{size:14,className:"mr-1"})," Edit Profile"]})]}),e.jsxs("div",{className:"profile-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx(N,{size:18,className:"text-primary"}),e.jsx("span",{children:(null==Z?void 0:Z.email)||"No email provided"})]}),(null==Z?void 0:Z.phoneNumber)&&e.jsxs("div",{className:"detail-item",children:[e.jsx(y,{size:18,className:"text-primary"}),e.jsx("span",{children:Z.phoneNumber})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(p,{size:18,className:"text-primary"}),e.jsxs("span",{children:["Member since ",(null==(S=null==Z?void 0:Z.metadata)?void 0:S.creationTime)?new Date(Z.metadata.creationTime).toLocaleDateString("en-US",{year:"numeric",month:"long"}):"recently"]})]})]}),e.jsx("div",{className:"profile-actions",children:e.jsxs("button",{className:"btn btn-outline btn-block",onClick:re,children:[e.jsx(v,{size:16,className:"mr-1"})," Sign Out"]})})]}),e.jsxs("div",{className:"quick-actions",children:[e.jsx("h3",{children:"Quick Actions"}),e.jsxs(m,{to:"/tours",className:"action-item",children:[e.jsx(w,{size:20,className:"text-primary"}),e.jsx("span",{children:"Book a Tour"})]}),e.jsxs(m,{to:"/bookings",className:"action-item",children:[e.jsx(p,{size:20,className:"text-primary"}),e.jsx("span",{children:"My Bookings"})]})]})]})]}),z&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Edit Profile"}),e.jsx("button",{className:"close-btn",onClick:()=>I(!1),children:e.jsx(b,{size:24})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Profile Photo"}),e.jsxs("div",{className:"profile-photo-upload",children:[e.jsx("div",{className:"photo-preview",children:E?e.jsx("img",{src:E,alt:"Preview"}):(null==Z?void 0:Z.photoURL)?e.jsx("img",{src:Z.photoURL,alt:"Profile"}):e.jsx(j,{size:48})}),e.jsxs("div",{className:"photo-upload-actions",children:[e.jsxs("label",{className:"btn btn-outline",children:[F.photoFile?"Change Photo":"Choose Photo",e.jsx("input",{type:"file",onChange:e=>{const s=e.target.files[0];if(!s)return;if(!s.type.match("image/(jpeg|png|jpg|gif)"))return void A("Please select a valid image file (JPEG, PNG, or GIF)");if(s.size>512e3)return void A("Image size should be less than 500KB");const a=new FileReader;a.onload=()=>{const e=a.result;M((s=>({...s,photoFile:e,photoURL:e}))),P(e),A("")},a.onerror=()=>{A("Error reading the image file")},a.readAsDataURL(s)},accept:"image/*",style:{display:"none"}})]}),(null==Z?void 0:Z.photoURL)&&e.jsx("button",{type:"button",className:"btn btn-text",onClick:()=>{M({...F,photoFile:null}),P("")},children:"Remove"})]}),e.jsx("p",{className:"photo-hint",children:"JPG, PNG, or GIF (max 2MB)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Display Name"}),e.jsx("input",{type:"text",className:"form-control",value:F.displayName,onChange:e=>M({...F,displayName:e.target.value}),placeholder:"Enter your name"})]}),B&&e.jsx("div",{className:"alert alert-error",children:B}),q&&e.jsx("div",{className:"alert alert-success",children:q}),e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:async()=>{if(Z)try{$(!0),A(""),G(""),F.displayName!==Z.displayName&&await r(Z,{displayName:F.displayName});let e=F.photoURL;F.photoFile&&Z.photoURL;const s=await n.get(`users/${Z.uid}`)||{};await n.update(`users/${Z.uid}`,{...s,displayName:F.displayName||Z.displayName||"",photoURL:e,updatedAt:(new Date).toISOString()}),M((s=>({...s,photoURL:e,photoFile:null}))),P(e),G("Profile updated successfully!"),I(!1),await i.currentUser.reload();const a=i.currentUser;M((s=>({...s,displayName:a.displayName||"",photoURL:e||a.photoURL||""})))}catch(e){A(e.message||"Failed to update profile")}finally{$(!1)}},disabled:!F.displayName.trim(),children:[e.jsx(f,{size:18,className:"mr-1"})," Save Changes"]}),e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>I(!1),style:{fontColor:"black",padding:"0.5rem 1.5rem",backgroundColor:"transparent",color:"#6b7280",border:"1px solid #d1d5db",borderRadius:"0.375rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",marginLeft:"0.75rem"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="#f3f4f6",e.currentTarget.style.borderColor="#9ca3af"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#d1d5db"},children:"Cancel"})]})]})]})})]})},S=()=>e.jsx(k,{});export{S as default};
