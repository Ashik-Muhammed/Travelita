import{u as e,h as a,j as s}from"./index-CGBRwBly.js";import{b as n,r as t,u as r}from"./router-CbvfO1vz.js";import"./react-CMmhtoO5.js";const i=()=>s.jsx("span",{className:"icon-style",children:"ðŸ“"}),c=()=>s.jsx("span",{className:"icon-style",children:"ðŸ•’"}),l=()=>{const{packageId:l}=n(),[o,d]=t.useState(null),[u,m]=t.useState(!0),[g,h]=t.useState(null),[p,x]=t.useState(0),[j,k]=t.useState(!1),[v,N]=t.useState(null),[y,f]=t.useState(!1);r();const{currentUser:b}=e(),{getPackageById:S,createBooking:w}=a(),I=t.useCallback((async()=>{if(l)try{m(!0),h(null);const e=await S(l);if(!e)throw new Error("Package not found");d(e)}catch(e){h(e.message||"Failed to fetch package")}finally{m(!1)}}),[l,S]),D=t.useRef(!1);if(t.useEffect((()=>{l&&!D.current&&(D.current=!0,I())}),[l,I]),u)return s.jsx("div",{className:"package-details-loading",children:s.jsx("div",{className:"spinner"})});if(g)return s.jsxs("div",{className:"container package-details-error",children:["Error: ",g]});if(!o)return s.jsx("div",{className:"container package-details-error",children:"Package not found."});const{title:P,description:E,destination:B,duration:T,price:W,images:C=[],included:O=[],itinerary:U=[],available:F}=o,$=C.map((e=>e.startsWith("http://")||e.startsWith("https://")?e:"https://source.unsplash.com/random/800x600/?travel,destination")),z=$.length>0?$[p]:"https://source.unsplash.com/random/800x600/?travel",A=!1!==F;return s.jsx("div",{className:"container package-details-container",children:s.jsxs("div",{className:"package-details-content",children:[s.jsxs("div",{className:"package-gallery",children:[s.jsx("div",{className:"main-image",children:s.jsx("img",{src:z,alt:P,onError:e=>{e.target.onerror=null,e.target.src="https://source.unsplash.com/random/800x600/?travel"}})}),$.length>1&&s.jsx("div",{className:"image-thumbnails",children:$.map(((e,a)=>s.jsx("div",{className:"thumbnail "+(p===a?"active":""),onClick:()=>x(a),children:s.jsx("img",{src:e,alt:`${P} - Image ${a+1}`,onError:e=>{e.target.onerror=null,e.target.src="https://source.unsplash.com/random/150x150/?travel"}})},a)))})]}),s.jsxs("div",{className:"package-info",children:[s.jsx("h1",{children:P}),s.jsxs("div",{className:"package-meta",children:[s.jsxs("p",{children:[s.jsx(i,{})," ",s.jsx("strong",{children:"Destination:"})," ",B]}),s.jsxs("p",{children:[s.jsx(c,{})," ",s.jsx("strong",{children:"Duration:"})," ",T]}),s.jsxs("p",{className:"package-price-tag",style:{fontSize:"1.5rem",color:"var(--secondary-color)",fontWeight:"bold",marginTop:"1rem"},children:["Price: â‚¹",W.toLocaleString()]})]}),s.jsx("p",{className:"description",children:E}),s.jsx("div",{className:"package-booking-section",children:A?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:async()=>{k(!0),N(null),f(!1);try{const e={userId:b.uid||b.id||"anonymous",userName:b.displayName||b.name||"Guest User",userEmail:b.email||"guest@example.com",packageId:l||"unknown",vendorId:o.vendorId||"system",packageTitle:o.title||"Tour Package",price:o.price||0,totalPrice:o.price||0,destination:o.destination||"Unknown",duration:o.duration||"1 Day",bookingDate:(new Date).toISOString(),startDate:(new Date).toISOString(),endDate:new Date(Date.now()+24*(parseInt(o.duration)||1)*60*60*1e3).toISOString(),guests:1,status:"pending",paymentStatus:"pending"};await w(e),f(!0)}catch(e){N("An error occurred during booking. Please try again.")}finally{k(!1)}},disabled:j||y,className:"book-now-button",children:j?"Processing...":y?"Booked!":"Book Now"}),v&&s.jsxs("p",{className:"booking-error-message",children:["Error: ",v]}),y&&s.jsx("p",{className:"booking-success-message",children:"Booking successful! You will be contacted shortly."})]}):s.jsx("p",{className:"package-unavailable-message",children:"This package is currently unavailable for booking."})}),O.length>0&&s.jsxs("div",{className:"package-section included-items",children:[s.jsx("h3",{children:"What's Included:"}),s.jsx("ul",{children:O.map(((e,a)=>s.jsx("li",{children:e},a)))})]}),U.length>0&&s.jsxs("div",{className:"package-section itinerary",children:[s.jsx("h3",{children:"Itinerary:"}),U.map(((e,a)=>s.jsxs("div",{className:"itinerary-day",children:[s.jsxs("h4",{children:["Day ",a+1,": ",e.title]}),s.jsx("p",{children:e.description})]},a)))]})]})]})})};export{l as default};
