import{u as e,b as s,i as a,c as t,q as i,o as n,k as r,m as l,j as d}from"./index-YV7c_xAD.js";import{r as c,u as o}from"./router-CbvfO1vz.js";import"./react-CMmhtoO5.js";const h=e=>{if(!e)return"N/A";try{const s=new Date(e);return isNaN(s.getTime())?"Invalid date":s.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(s){return"Invalid date"}},m=(e,s="error")=>{window.alert(`${s.toUpperCase()}: ${e}`)},x=({vendorView:x=!1})=>{const[j,u]=c.useState([]),[g,b]=c.useState(!0),[N,p]=c.useState(""),{currentUser:y}=e(),{getUserBookings:v,getVendorBookings:k}=s(),f=o(),w=a();return w?(c.useEffect((()=>{if(!y)return void f("/login");(async()=>{try{b(!0),p("");let e=[];e=x?await k(y.uid):await v(y.uid),e.sort(((e,s)=>{const a=e.createdAt?new Date(e.createdAt):new Date(0);return(s.createdAt?new Date(s.createdAt):new Date(0))-a})),u(e)}catch(e){const s=e.message||"Failed to load bookings. Please try again later.";p(s),m(s)}finally{b(!1)}})();try{const e=t(w,"bookings");let s;s=i(e,n(x?"vendorId":"userId"),r(y.uid));const a=l(s,(e=>{if(e.exists()){const s=[];e.forEach((e=>{s.push({id:e.key,...e.val()})})),u(s)}else u([])}),(e=>{p("Failed to load bookings. Please try again."),m("Failed to load bookings. Please try again.")}));return()=>{a&&a()}}catch(e){p("Failed to initialize database connection."),m("Failed to initialize database connection.")}}),[y,f,x,v,k]),g?d.jsx("div",{className:"container py-5",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"spinner-border text-primary",role:"status",children:d.jsx("span",{className:"visually-hidden",children:"Loading..."})}),d.jsxs("p",{className:"mt-2",children:["Loading ",x?"vendor":"your"," bookings..."]})]})}):N?d.jsx("div",{className:"container py-5",children:d.jsx("div",{className:"alert alert-danger",children:N})}):d.jsxs("div",{className:"container py-5",children:[d.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[d.jsx("h2",{children:x?"Vendor Bookings":"My Bookings"}),x&&d.jsxs("button",{className:"btn btn-primary",onClick:()=>window.location.reload(),children:[d.jsx("i",{className:"fas fa-sync-alt me-2"}),"Refresh"]})]}),0===j.length?d.jsx("div",{className:"text-center py-5",children:d.jsxs("div",{className:"empty-state",children:[d.jsx("i",{className:"fas fa-calendar-alt fa-4x mb-3 text-muted"}),d.jsx("h3",{children:"No Bookings Found"}),d.jsx("p",{className:"text-muted",children:x?"You have no bookings for your packages yet.":"You have not made any bookings yet."}),!x&&d.jsx("button",{className:"btn btn-primary mt-3",onClick:()=>f("/packages"),children:"Browse Packages"})]})}):d.jsx("div",{className:"table-responsive",children:d.jsxs("table",{className:"table table-hover align-middle",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{children:"Booking ID"}),x&&d.jsx("th",{children:"Booked By"}),d.jsx("th",{children:"Package"}),d.jsx("th",{children:"Date"}),d.jsx("th",{children:"Guests"}),d.jsx("th",{children:"Total Price"}),d.jsx("th",{children:"Status"}),x&&d.jsx("th",{children:"Actions"})]})}),d.jsx("tbody",{children:j.map((e=>{var s;return d.jsxs("tr",{children:[d.jsxs("td",{children:[e.id.substring(0,8),"..."]}),x&&d.jsxs("td",{children:[e.userName||"N/A",d.jsx("br",{}),d.jsx("small",{className:"text-muted",children:e.userEmail||""})]}),d.jsx("td",{children:d.jsxs("div",{className:"d-flex align-items-center",children:[e.packageImage&&d.jsx("img",{src:e.packageImage,alt:e.packageName,className:"me-2",style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"}}),d.jsxs("div",{children:[d.jsx("div",{className:"fw-semibold",children:e.packageName||"N/A"}),d.jsx("small",{className:"text-muted",children:h(e.travelDate)})]})]})}),d.jsx("td",{children:h(e.createdAt)}),d.jsx("td",{children:e.guests||1}),d.jsxs("td",{children:["â‚¹",(null==(s=e.totalPrice)?void 0:s.toLocaleString())||"0"]}),d.jsx("td",{children:d.jsx("span",{className:"badge "+("confirmed"===e.status?"bg-success":"bg-warning"),children:e.status||"pending"})}),x&&d.jsx("td",{children:d.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>f(`/bookings/${e.id}`),children:"View"})})]},e.id)}))})]})})]})):null};export{x as Bookings,x as default};
