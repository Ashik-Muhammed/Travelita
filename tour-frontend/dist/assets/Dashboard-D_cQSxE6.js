import{f as e,u as a,c as s,b as l,j as i,i as o,k as t}from"./index-C_BwQPEG.js";import{r as n,u as r,L as c}from"./router-CLN5X-po.js";import"./react-CMmhtoO5.js";const d=()=>{var d;const[h,m]=n.useState([]),[p,u]=n.useState(!0),[x,v]=n.useState(null),[g,j]=n.useState(!1),[N,f]=n.useState({displayName:"",photoFile:null}),[b,w]=n.useState(""),[y,k]=n.useState(""),[R,z]=n.useState(""),P=r(),{currentUser:U,isLoading:L,refreshUser:M}=e(),[C,S]=n.useState("");n.useEffect((()=>{(null==U?void 0:U.photoURL)&&(S(U.photoURL),w(U.photoURL))}),[null==U?void 0:U.photoURL]);const{getUserBookings:F}=a();n.useEffect((()=>{if(!L&&!U)return void P("/login");L||(async()=>{if(U)try{const e=await F();m(e||[]),u(!1)}catch(e){v("Failed to load dashboard data. Please try again."),u(!1)}})()}),[P,U,F,L]);const A=n.useCallback((async()=>{try{await s(l),localStorage.removeItem("user"),P("/")}catch(e){}}),[P]);return p?i.jsx("div",{className:"loading-container",children:i.jsx("div",{className:"spinner"})}):x?i.jsxs("div",{className:"error-container",children:[i.jsx("h2",{children:"Error"}),i.jsx("p",{children:x}),i.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Try Again"})]}):i.jsxs("div",{className:"dashboard-page",children:[i.jsx("div",{className:"dashboard-header",children:i.jsxs("div",{className:"container",children:[i.jsx("h1",{children:"My Dashboard"}),i.jsxs("p",{children:["Welcome back, ",(null==U?void 0:U.displayName)||(null==U?void 0:U.email),"!"]})]})}),i.jsx("div",{className:"container",children:i.jsxs("div",{className:"dashboard-grid",children:[i.jsxs("div",{className:"dashboard-card profile-card",children:[i.jsx("h2",{children:"My Profile"}),g?i.jsxs("form",{onSubmit:async e=>{e.preventDefault(),k(""),z("");try{const e=l.currentUser;if(!e)throw new Error("No authenticated user found");const s={},i={email:e.email,lastUpdated:Date.now()},n=N.displayName.trim();if(n&&n!==(e.displayName||"")&&(s.displayName=n,i.displayName=n),N.photoFile){const e=await(a=N.photoFile,new Promise(((e,s)=>{const l=new FileReader;l.readAsDataURL(a),l.onload=()=>e(l.result),l.onerror=e=>s(e)})));i.photoURL=e}else""===b?i.photoURL="":b&&b!==(null==U?void 0:U.photoURL)&&(i.photoURL=b);if(Object.keys(s).length>0&&await o(e,s),await t.set(`users/${e.uid}`,i),s.displayName&&await o(e,{displayName:s.displayName}),z("Profile updated successfully!"),f({displayName:n,photoFile:null}),M){const e=await M();(null==e?void 0:e.photoURL)&&w(e.photoURL)}setTimeout((()=>{j(!1),z("")}),2e3)}catch(s){k(`Failed to update profile. ${s.message||"Please try again."}`)}var a},className:"profile-edit-form",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"displayName",children:"Display Name"}),i.jsx("input",{type:"text",id:"displayName",name:"displayName",value:N.displayName,onChange:e=>{const{name:a,value:s}=e.target;f((e=>({...e,[a]:s})))},className:"form-control",required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"profilePhoto",children:"Profile Photo"}),i.jsxs("div",{className:"profile-photo-upload",children:[i.jsx("div",{className:"photo-preview",children:b?i.jsx("img",{src:b,alt:"Profile preview",className:"preview-image"}):i.jsx("div",{className:"photo-placeholder",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z",clipRule:"evenodd"})})})}),i.jsxs("div",{className:"file-input-container",children:[i.jsx("input",{type:"file",id:"profilePhoto",name:"profilePhoto",accept:"image/*",onChange:e=>{const a=e.target.files[0];if(!a)return;if(!a.type.startsWith("image/"))return void k("Please upload an image file");if(a.size>5242880)return void k("Image size should be less than 5MB");f((e=>({...e,photoFile:a})));const s=new FileReader;s.onloadend=()=>{w(s.result),k("")},s.readAsDataURL(a)},className:"file-input"}),i.jsx("label",{htmlFor:"profilePhoto",className:"btn btn-outline",children:N.photoFile?"Change Photo":"Upload Photo"}),N.photoFile&&i.jsx("button",{type:"button",className:"btn btn-text",onClick:()=>{f((e=>({...e,photoFile:null}))),w((null==U?void 0:U.photoURL)||"")},children:"Remove"})]})]})]}),y&&i.jsx("div",{className:"alert alert-danger",children:y}),R&&i.jsx("div",{className:"alert alert-success",children:R}),i.jsxs("div",{className:"form-actions",children:[i.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save Changes"}),i.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>j(!1),children:"Cancel"})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"profile-info",children:[i.jsx("div",{className:"profile-avatar",children:C?i.jsx("img",{src:C,alt:(null==U?void 0:U.displayName)||"User",className:"profile-image",onError:e=>{e.target.style.display="none",e.target.nextElementSibling.style.display="block"}}):i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z",clipRule:"evenodd",style:{display:C?"none":"block"}})})}),i.jsxs("div",{className:"profile-details",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Name:"})," ",(null==U?void 0:U.displayName)||"Not set"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Email:"})," ",null==U?void 0:U.email]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Role:"})," ",(null==U?void 0:U.role)||"user"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Member Since:"})," ",(null==(d=null==U?void 0:U.metadata)?void 0:d.creationTime)?new Date(U.metadata.creationTime).toLocaleDateString():"Unknown"]})]})]}),i.jsxs("div",{className:"profile-actions",children:[i.jsx("button",{className:"btn btn-outline",onClick:()=>{try{f({displayName:(null==U?void 0:U.displayName)||"",photoFile:null}),w((null==U?void 0:U.photoURL)||""),j(!0)}catch(e){k("Failed to load profile data")}},children:"Edit Profile"}),i.jsx("button",{onClick:A,className:"btn btn-danger",children:"Logout"})]})]})]}),i.jsxs("div",{className:"dashboard-card bookings-card",children:[i.jsx("h2",{children:"Recent Bookings"}),h.length>0?i.jsx("div",{className:"bookings-list",children:h.slice(0,3).map((e=>{var a;return i.jsxs("div",{className:"booking-item",children:[i.jsxs("div",{className:"booking-info",children:[i.jsx("h3",{children:e.packageTitle||"Package Title"}),i.jsxs("p",{children:[i.jsx("strong",{children:"Status:"})," ",i.jsx("span",{className:`status ${e.status}`,children:e.status})]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Date:"})," ",e.bookingDate?new Date(e.bookingDate).toLocaleDateString():"Unknown"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Price:"})," â‚¹",(null==(a=e.price)?void 0:a.toLocaleString())||"0"]})]}),i.jsx(c,{to:`/packages/${e.packageId}`,className:"btn btn-sm btn-primary",children:"View Package"})]},e.id)}))}):i.jsxs("div",{className:"no-bookings",children:[i.jsx("p",{children:"You haven't made any bookings yet."}),i.jsx(c,{to:"/packages",className:"btn btn-primary",children:"Browse Packages"})]}),h.length>3&&i.jsx(c,{to:"/bookings",className:"btn btn-outline view-all",children:"View All Bookings"})]}),i.jsxs("div",{className:"dashboard-card actions-card",children:[i.jsx("h2",{children:"Quick Actions"}),i.jsxs("div",{className:"quick-actions",children:[i.jsxs(c,{to:"/packages",className:"action-item",children:[i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:[i.jsx("path",{d:"M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z"}),i.jsx("path",{d:"M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z"})]}),"Browse Packages"]}),i.jsxs(c,{to:"/bookings",className:"action-item",children:[i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:[i.jsx("path",{fillRule:"evenodd",d:"M7.502 6h7.128A3.375 3.375 0 0118 9.375v9.375a3 3 0 003-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 00-.673-.05A3 3 0 0015 1.5h-1.5a3 3 0 00-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6zM13.5 3A1.5 1.5 0 0012 4.5h4.5A1.5 1.5 0 0015 3h-1.5z",clipRule:"evenodd"}),i.jsx("path",{fillRule:"evenodd",d:"M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 013 20.625V9.375zM6 12a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75H6.75a.75.75 0 01-.75-.75V12zm2.25 0a.75.75 0 01.75-.75h3.75a.75.75 0 010 1.5H9a.75.75 0 01-.75-.75zM6 15a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75H6.75a.75.75 0 01-.75-.75V15zm2.25 0a.75.75 0 01.75-.75h3.75a.75.75 0 010 1.5H9a.75.75 0 01-.75-.75zM6 18a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75H6.75a.75.75 0 01-.75-.75V18zm2.25 0a.75.75 0 01.75-.75h3.75a.75.75 0 010 1.5H9a.75.75 0 01-.75-.75z",clipRule:"evenodd"})]}),"My Bookings"]}),i.jsxs(c,{to:"/packages/top",className:"action-item",children:[i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}),"Top Packages"]}),i.jsxs(c,{to:"/packages/budget",className:"action-item",children:[i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M4.5 6.375a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0zM14.25 8.625a3.375 3.375 0 116.75 0 3.375 3.375 0 01-6.75 0zM1.5 19.125a7.125 7.125 0 0114.25 0v.003l-.001.119a.75.75 0 01-.363.63 13.067 13.067 0 01-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 01-.364-.63l-.001-.122zM17.25 19.128l-.001.144a2.25 2.25 0 01-.233.96 10.088 10.088 0 005.06-1.01.75.75 0 00.42-.643 4.875 4.875 0 00-6.957-4.611 8.586 8.586 0 011.71 5.157v.003z"})}),"Budget Packages"]})]})]})]})})]})};export{d as default};
