import{j as e,u as s,b as a,e as t,a as i,t as n,y as r,c as l,z as c,g as o,w as d,v as h}from"./index-YV7c_xAD.js";import{r as m,u as p,L as x}from"./router-CbvfO1vz.js";import{l as u,m as j,n as g,c as N,o as y,p as v,F as f,i as b,q as w,r as D,s as k}from"./index-DOWsMtyp.js";import{m as S}from"./index-DSyyveMz.js";import"./react-CMmhtoO5.js";import"./iconBase-YQ9d7kAD.js";const U=({className:s="",width:a="100%",height:t="200px"})=>e.jsx("div",{className:`bg-gray-100 flex items-center justify-center text-gray-400 ${s}`,style:{width:a,height:t},children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"opacity-50",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]})}),L=e=>{if(!e)return"";return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})},C=()=>{var C,T;const[R,$]=m.useState([]),[I,z]=m.useState(!0),[E,M]=m.useState(!1),[P,F]=m.useState(!1),[B,A]=m.useState(""),[q,G]=m.useState({displayName:"",photoFile:null,photoURL:""}),[O,H]=m.useState(""),[W,J]=m.useState(""),[V,Y]=m.useState(!1),[K,Q]=m.useState(null),[X,Z]=m.useState(""),[_,ee]=m.useState({days:0,nights:0}),se=p(),{currentUser:ae,logout:te}=s(),{refreshUser:ie}=a(),{getUserBookings:ne}=a(),re=e=>{if(!e)return"Date not set";const s=new Date(e),a=new Date;a.setHours(0,0,0,0);const t=new Date(a);t.setDate(t.getDate()+1);const i=s.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!0});if(s.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"}),s.toDateString()===a.toDateString())return`Today at ${i}`;if(s.toDateString()===t.toDateString())return`Tomorrow at ${i}`;if(s>a){const e=s-a,t=Math.ceil(e/864e5);return`in ${t} day${t>1?"s":""}`}return s.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},le=e=>{if(!e)return"upcoming";const s=new Date(e),a=new Date;return a.setHours(0,0,0,0),s<a?"completed":s.toDateString()===a.toDateString()?"today":"upcoming"},ce=R.filter((e=>{if(!e.date)return!1;const s=new Date(e.date),a=new Date;a.setHours(0,0,0,0);const t=new Date;return t.setDate(a.getDate()+90),s>=a&&s<=t})).sort(((e,s)=>new Date(e.date)-new Date(s.date))),oe=[...R].filter((e=>e.date)).sort(((e,s)=>new Date(s.date)-new Date(e.date))).slice(0,3),de=m.useCallback((async()=>{try{await t(i),se("/")}catch(e){}}),[se]),he=m.useCallback((async()=>{if(ae)try{const e=await n.get(`users/${ae.uid}`);e&&(G((s=>({...s,displayName:e.displayName||"",photoURL:e.photoURL||""}))),A(e.photoURL||""));const s=await n.get(`users/${ae.uid}/trips`);if(s){const e=Object.entries(s).map((([e,s])=>({id:e,...s}))),a=new Date,t=new Date;t.setDate(a.getDate()+30);const i=e.filter((e=>{const s=new Date(e.startDate);return s>a&&s<=t}));$(i)}}catch(e){H("Failed to load user data")}finally{z(!1)}}),[ae]),me=e=>{if(!e.startDate)return"";const s=new Date,a=new Date(e.startDate)-s;if(a<=0)return"Trip in progress";const t=Math.floor(a/864e5),i=Math.floor(a%864e5/36e5),n=Math.floor(a%36e5/6e4);return t>1?`${t} days, ${i} hours left`:1===t?`1 day, ${i} hours left`:i>0?`${i}h ${n}m left`:`${n} minutes left`},pe=m.useCallback((()=>{if(!R||0===R.length)return;const e=new Date,s=R.filter((s=>new Date(s.startDate)>e)).sort(((e,s)=>new Date(e.startDate)-new Date(s.startDate)));if(s.length>0){const a=s[0];Q(a);const t=new Date(a.startDate)-e;if(t>0){const e=Math.floor(t/864e5),s=Math.floor(t%864e5/36e5),a=Math.floor(t%36e5/6e4);Z(`${e>0?`${e}d `:""}${s}h ${a}m`)}}}),[R]),xe=m.useCallback((e=>{if(!e||!e.length)return{days:0,nights:0};let s=0,a=0;return e.forEach((e=>{const t=[e.packageName||"",e.description||"",e.durationText||""].join(" "),i=[...t.matchAll(/(\d+)\s*days?\s*,\s*(\d+)\s*nights?/gi)];if(i.length>0)i.forEach((e=>{const t=parseInt(e[1],10)||0,i=parseInt(e[2],10)||0;s+=t,a+=i}));else{const e=t.match(/(\d+)\s*days?/i),i=t.match(/(\d+)\s*nights?/i),n=e?parseInt(e[1],10):0,r=i?parseInt(i[1],10):0;n>0||r>0?(s+=n||r+1,a+=r||(n>0?n-1:0)):s+=1}})),{days:s,nights:a}}),[]);m.useEffect((()=>{pe();const e=setInterval(pe,6e4);return()=>clearInterval(e)}),[pe]),m.useCallback((async()=>{if(ae){z(!0);try{const e=await ne(ae.uid);$(e);const s=[...e].sort(((e,s)=>new Date(s.createdAt)-new Date(e.createdAt))).slice(0,5);setRecentBookings(s);const{days:a,nights:t}=xe(e);ee({days:a,nights:t}),pe()}catch(e){setError("Failed to load bookings. Please try again.")}finally{z(!1)}}}),[ae,ne,pe]);m.useEffect((()=>{he()}),[he]);const ue=()=>{G({displayName:(null==ae?void 0:ae.displayName)||"",photoURL:(null==ae?void 0:ae.photoURL)||""}),A((null==ae?void 0:ae.photoURL)||""),F(!0)};return m.useEffect((()=>{(async()=>{try{const e=await ne();if($(e||[]),e&&e.length>0){const s=(e=>{let s=0,a=0;return e&&Array.isArray(e)?(e.forEach((e=>{var t;if(!e)return;const i=(null==(t=e.duration)?void 0:t.toString())||"";if(i)if(isNaN(parseInt(i,10))){const e=i.match(/(\d+)\s*day/i),t=i.match(/(\d+)\s*night/i);e&&(s+=parseInt(e[1],10)),t&&(a+=parseInt(t[1],10))}else{const e=parseInt(i,10);s+=e,a+=Math.max(0,e-1)}})),s>0&&0===a&&(a=Math.max(0,s-1)),{days:s,nights:a}):{days:0,nights:0}})(e);ee(s)}else ee({days:0,nights:0})}catch(e){}finally{z(!1)}})()}),[ne]),e.jsxs("div",{className:"dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsxs("div",{className:"dashboard-header-content",children:[e.jsxs("div",{className:"welcome-section",children:[e.jsxs("h1",{children:["Welcome back, ",(null==(C=null==ae?void 0:ae.displayName)?void 0:C.split(" ")[0])||"Explorer","! ðŸ‘‹"]}),e.jsx("p",{children:"Here's what's happening with your travel plans"})]}),e.jsxs("div",{className:"quick-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(u,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{children:R.length}),e.jsx("p",{children:"Upcoming Trips"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(j,{size:24})}),e.jsxs("div",{children:[e.jsxs("h3",{children:[_.days," days, ",_.nights," nights"]}),e.jsx("p",{children:"Total Trip Duration"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(g,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{children:R.length}),e.jsx("p",{children:"Total Bookings"})]})]})]})]})}),e.jsxs("div",{className:"dashboard-container",children:[e.jsxs("div",{className:"dashboard-main",children:[e.jsxs("section",{className:"dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"Upcoming Trips"}),e.jsx(x,{to:"/tours",className:"btn-link",children:"Explore More Tours"})]}),I?e.jsx("div",{className:"loading-state",children:"Loading your trips..."}):ce.length>0?e.jsx("div",{className:"booking-cards",children:ce.map((s=>e.jsxs("div",{className:`booking-card ${le(s.date)}`,children:[e.jsx("div",{className:"booking-image",style:{backgroundImage:`url(${s.packageImage||"/placeholder-tour.jpg"})`},children:e.jsxs("div",{className:"trip-status",children:["today"===le(s.date)&&"Today","upcoming"===le(s.date)&&L(s.date),"completed"===le(s.date)&&"Completed"]})}),e.jsxs("div",{className:"booking-details",children:[e.jsxs("div",{className:"booking-header",children:[e.jsx("h3",{children:s.packageName}),e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})]}),e.jsxs("div",{className:"booking-meta",children:[e.jsxs("span",{children:[e.jsx(u,{className:"icon"})," ",new Date(s.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("span",{children:[e.jsx(N,{className:"icon"})," ",s.travelers," traveler",s.travelers>1?"s":""]}),s.specialRequests&&e.jsxs("span",{className:"special-request",children:[e.jsx(y,{className:"icon"})," Special request"]})]}),e.jsxs("div",{className:"booking-actions",children:[e.jsx(x,{to:`/bookings/${s.id}`,className:"btn btn-outline btn-sm",children:"View Details"}),"today"===le(s.date)&&e.jsx(x,{to:`/tours/${s.tourId||"tour"}`,className:"btn btn-primary btn-sm",children:"Start Trip"})]})]})]},s.id)))}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-illustration",children:e.jsx(S,{size:48,className:"text-muted"})}),e.jsx("h3",{children:"No Upcoming Trips"}),e.jsx("p",{children:"You don't have any trips planned in the next 30 days."}),e.jsx(x,{to:"/tours",className:"btn btn-primary",children:"Browse Tours"})]})]}),e.jsxs("section",{className:"dashboard-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h2",{children:"Recent Activity"})}),e.jsxs("div",{className:"upcoming-bookings",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Upcoming Trips"}),K&&e.jsxs("div",{className:"next-trip-countdown",children:[e.jsx("span",{className:"countdown-label",children:"Next trip in:"}),e.jsx("span",{className:"countdown-timer",children:X})]})]}),K&&e.jsx("div",{className:"next-trip-highlight",children:e.jsxs("div",{className:"next-trip-card",children:[e.jsxs("div",{className:"trip-image",children:[K.packageImage?e.jsx("img",{src:K.packageImage,alt:K.packageName,onError:e=>{e.target.style.display="none",e.target.nextElementSibling.style.display="flex"}}):null,e.jsx(U,{className:"trip-placeholder"}),e.jsx("div",{className:"trip-overlay",children:e.jsx("span",{className:"badge",children:"Next Up"})})]}),e.jsxs("div",{className:"trip-content",children:[e.jsx("h4",{children:K.packageName}),e.jsxs("div",{className:"trip-meta",children:[e.jsxs("span",{className:"trip-date",children:[e.jsx(u,{})," ",re(K.startDate)]}),K.duration&&e.jsxs("span",{className:"trip-duration",children:[e.jsx(j,{})," ",K.duration," ",1===K.duration?"hour":"hours"]})]}),e.jsxs("div",{className:"trip-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.min(100,(new Date(K.startDate)-new Date)/(new Date(K.startDate)-new Date(K.createdAt||new Date))*100)}%`}})}),e.jsxs("div",{className:"progress-labels",children:[e.jsx("span",{children:"Booked"}),e.jsx("span",{children:"Departure"})]})]})]})]})}),R.length>1&&e.jsxs("div",{className:"other-trips",children:[e.jsx("h4",{children:"Other Upcoming Trips"}),I?e.jsx("div",{className:"loading",children:"Loading trips..."}):0===R.length?e.jsx("div",{className:"no-trips",children:"No upcoming trips in the next 30 days"}):e.jsx("div",{className:"upcoming-trips",children:R.map((s=>e.jsxs("div",{className:"trip-card",children:[e.jsxs("div",{className:"trip-image",children:[s.packageImage?e.jsx("img",{src:s.packageImage,alt:s.packageName,onError:e=>{e.target.style.display="none",e.target.nextElementSibling.style.display="flex"}}):null,e.jsx(U,{className:"trip-placeholder"})]}),e.jsxs("div",{className:"trip-details",children:[e.jsx("h3",{children:s.packageName}),e.jsxs("div",{className:"trip-meta",children:[e.jsxs("span",{className:"trip-date",children:[e.jsx(u,{})," ",re(s.startDate)]}),s.timeSlot&&e.jsxs("span",{className:"trip-time",children:[e.jsx(j,{})," ",s.timeSlot]}),s.duration&&e.jsxs("span",{className:"trip-duration",children:[e.jsx(j,{})," ",s.duration," ",1===s.duration?"hour":"hours"]})]}),e.jsx("div",{className:"time-left",children:e.jsx("span",{className:"badge",children:me(s)})}),e.jsxs("div",{className:"trip-actions",children:[e.jsx("button",{className:"btn btn-sm btn-outline cancel-trip-btn",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to cancel this trip? This action cannot be undone."))try{Y(e);const s=c(),a=l(s,`bookings/${e}`);await h(a),$((s=>s.filter((s=>s.id!==e)))),setRecentBookings((s=>s.filter((s=>s.id!==e)))),J("Trip cancelled successfully!"),setTimeout((()=>J("")),3e3)}catch(s){H("Failed to cancel trip. Please try again."),setTimeout((()=>H("")),3e3)}finally{Y(!1)}})(s.id),disabled:V===s.id,children:V===s.id?"Cancelling...":"Cancel Trip"}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>se(`/booking/${s.id}`),children:"View Details"})]})]})]},s.id)))})]})]}),oe.length>0?e.jsx("div",{className:"activity-feed",children:oe.map(((s,a)=>e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:e.jsx(u,{size:20})}),e.jsxs("div",{className:"activity-content",children:[e.jsxs("p",{children:["You booked ",e.jsx("strong",{children:s.tourName})]}),e.jsx("span",{className:"activity-time",children:L(s.date)})]})]},a)))}):e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No recent activity to show"})})]})]}),e.jsxs("aside",{className:"dashboard-sidebar",children:[e.jsxs("div",{className:"profile-card",children:[e.jsxs("div",{className:"profile-header",children:[e.jsxs("div",{className:"profile-avatar",onClick:ue,children:[(null==ae?void 0:ae.photoURL)?e.jsx("img",{src:ae.photoURL,alt:ae.displayName||"User"}):e.jsx("div",{className:"avatar-placeholder",children:e.jsx(N,{size:32})}),e.jsx("div",{className:"edit-overlay",children:e.jsx(v,{size:20})})]}),e.jsx("h3",{children:(null==ae?void 0:ae.displayName)||"Travel Enthusiast"}),e.jsx("p",{className:"text-muted",children:null==ae?void 0:ae.email}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:ue,children:[e.jsx(v,{size:14,className:"mr-1"})," Edit Profile"]})]}),e.jsxs("div",{className:"profile-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx(f,{size:18,className:"text-primary"}),e.jsx("span",{children:(null==ae?void 0:ae.email)||"No email provided"})]}),(null==ae?void 0:ae.phoneNumber)&&e.jsxs("div",{className:"detail-item",children:[e.jsx(b,{size:18,className:"text-primary"}),e.jsx("span",{children:ae.phoneNumber})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(u,{size:18,className:"text-primary"}),e.jsxs("span",{children:["Member since ",(null==(T=null==ae?void 0:ae.metadata)?void 0:T.creationTime)?new Date(ae.metadata.creationTime).toLocaleDateString("en-US",{year:"numeric",month:"long"}):"recently"]})]})]}),e.jsx("div",{className:"profile-actions",children:e.jsxs("button",{className:"btn btn-outline btn-block",onClick:de,children:[e.jsx(w,{size:16,className:"mr-1"})," Sign Out"]})})]}),e.jsxs("div",{className:"quick-actions",children:[e.jsx("h3",{children:"Quick Actions"}),e.jsxs(x,{to:"/tours",className:"action-item",children:[e.jsx(S,{size:20,className:"text-primary"}),e.jsx("span",{children:"Book a Tour"})]}),e.jsxs(x,{to:"/bookings",className:"action-item",children:[e.jsx(u,{size:20,className:"text-primary"}),e.jsx("span",{children:"My Bookings"})]})]})]})]}),P&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Edit Profile"}),e.jsx("button",{className:"close-btn",onClick:()=>F(!1),children:e.jsx(D,{size:24})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Profile Photo"}),e.jsxs("div",{className:"profile-photo-upload",children:[e.jsx("div",{className:"photo-preview",children:B?e.jsx("img",{src:B,alt:"Preview"}):(null==ae?void 0:ae.photoURL)?e.jsx("img",{src:ae.photoURL,alt:"Profile"}):e.jsx(N,{size:48})}),e.jsxs("div",{className:"photo-upload-actions",children:[e.jsxs("label",{className:"btn btn-outline",children:[q.photoFile?"Change Photo":"Choose Photo",e.jsx("input",{type:"file",onChange:e=>{const s=e.target.files[0];if(!s)return;if(!s.type.match("image/(jpeg|png|jpg|gif)"))return void H("Please select a valid image file (JPEG, PNG, or GIF)");if(s.size>512e3)return void H("Image size should be less than 500KB");const a=new FileReader;a.onload=()=>{const e=a.result;G((s=>({...s,photoFile:e,photoURL:e}))),A(e),H("")},a.onerror=()=>{H("Error reading the image file")},a.readAsDataURL(s)},accept:"image/*",style:{display:"none"}})]}),(null==ae?void 0:ae.photoURL)&&e.jsx("button",{type:"button",className:"btn btn-text",onClick:()=>{G({...q,photoFile:null}),A("")},children:"Remove"})]}),e.jsx("p",{className:"photo-hint",children:"JPG, PNG, or GIF (max 2MB)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Display Name"}),e.jsx("input",{type:"text",className:"form-control",value:q.displayName,onChange:e=>G({...q,displayName:e.target.value}),placeholder:"Enter your name"})]}),O&&e.jsx("div",{className:"alert alert-error",children:O}),W&&e.jsx("div",{className:"alert alert-success",children:W}),e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:async()=>{if(ae)try{M(!0),H(""),J("");const e=i.currentUser;if(!e)throw new Error("No authenticated user found");q.displayName&&q.displayName!==e.displayName&&await r(e,{displayName:q.displayName});let s=q.photoURL;q.photoFile&&e.photoURL;const a=l(c(),`users/${e.uid}`),t=(await o(a)).val()||{};await d(a,{...t,displayName:q.displayName||e.displayName||"",photoURL:s||e.photoURL||"",updatedAt:(new Date).toISOString()}),G((e=>({...e,photoURL:s,photoFile:null}))),A(s),J("Profile updated successfully!"),F(!1),await e.reload();const n=i.currentUser;n&&G((e=>({...e,displayName:n.displayName||"",photoURL:s||n.photoURL||""})))}catch(e){H(e.message||"Failed to update profile")}finally{M(!1)}else H("No user is currently signed in.")},disabled:!q.displayName.trim(),children:[e.jsx(k,{size:18,className:"mr-1"})," Save Changes"]}),e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>F(!1),style:{fontColor:"black",padding:"0.5rem 1.5rem",backgroundColor:"transparent",color:"#6b7280",border:"1px solid #d1d5db",borderRadius:"0.375rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",marginLeft:"0.75rem"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="#f3f4f6",e.currentTarget.style.borderColor="#9ca3af"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#d1d5db"},children:"Cancel"})]})]})]})})]})},T=()=>e.jsx(C,{});export{T as default};
